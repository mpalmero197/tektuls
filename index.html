<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TekTuls - Comprehensive Troubleshooting Dashboard (Dark Mode)</title>
  <!-- Include Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Include Leaflet.js for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Include QRCode.js for QR Code Generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Include Roboto Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    :root {
      --primary-color: #2196f3;
      --primary-light: #64b5f6;
      --primary-dark: #0b79d0;
      --secondary-color: #03dac6;
      --background-color: #121212;
      --surface-color: #1E1E1E;
      --text-primary: #ffffff;
      --text-secondary: #cfcfcf;
      --border-radius: 8px;
      --font-family: 'Roboto', sans-serif;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background: var(--background-color);
      color: var(--text-primary);
    }

    body {
      display: flex;
      min-height: 100vh;
      overflow: auto;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background-color: #333;
      border-radius: 4px;
    }

    /* Remove the fixed sidebar and rely on a drawer menu */
    /* Removed .sidebar styles */

    .main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .top-bar {
      height: 60px;
      flex-shrink: 0;
      background: var(--surface-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      position: relative;
      z-index: 1000;
    }

    .top-bar .title {
      display: flex;
      align-items: center;
      gap: 10px;
      height: 60px;
      position: relative;
    }

    /* Hamburger menu icon */
    .hamburger-menu {
      width: 30px;
      height: 30px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 5px 0;
      margin-right: 10px;
    }

    .hamburger-menu span {
      display: block;
      height: 3px;
      background: var(--text-primary);
      border-radius: 2px;
      transition: transform 0.3s ease;
    }

    .top-bar .title::before {
      content: '';
      width: 120px;
      height: 60px;
      background: url('https://github.com/mpalmero197/tektuls/blob/main/tektuls-01.png?raw=true') no-repeat center center / contain;
      display: inline-block;
    }

    /* Hidden drawer menu */
    .drawer-menu {
      position: fixed;
      top: 60px;
      left: 0;
      width: 200px;
      background: var(--surface-color);
      border-right: 1px solid #333;
      box-shadow: 2px 0 5px rgba(0,0,0,0.5);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 9999;
      padding: 20px 0;
    }

    .drawer-menu.open {
      transform: translateX(0);
    }

    .drawer-menu a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 1rem;
      transition: background 0.3s;
    }

    .drawer-menu a:hover {
      background: var(--primary-dark);
      color: #fff;
    }

    .top-bar .search-container {
      display: flex;
      align-items: center;
      background: var(--surface-color);
      border-radius: var(--border-radius);
      padding: 5px 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
      max-width: 100%;
    }

    .top-bar input, .top-bar select {
      border: none;
      background: transparent;
      outline: none;
      color: var(--text-primary);
      margin: 0 10px;
      font-size: 0.9rem;
      flex-shrink: 1;
    }

    .top-bar input::placeholder {
      color: var(--text-secondary);
    }

    .top-bar button {
      background: var(--primary-color);
      border: none;
      border-radius: var(--border-radius);
      padding: 5px 15px;
      color: #fff;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: background 0.3s, box-shadow 0.3s, transform 0.3s;
    }

    .top-bar button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    .top-bar select {
      background: #222;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 0.9rem;
      margin-right: 10px;
      max-width:100%;
      border-radius: var(--border-radius);
      padding: 5px;
    }

    .top-bar select option {
      background-color: #222;
      color: var(--text-primary);
    }

    .content {
      flex-grow: 1;
      overflow-y: auto;
      padding: 40px;
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .panel {
      background: var(--surface-color);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel h2 {
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-primary);
      margin: 0;
    }

    .panel-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .panel-sub {
      background: var(--surface-color);
      border-radius: var(--border-radius);
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      gap: 15px;
      position: relative;
      word-break: break-word;
      white-space: normal;
    }

    .panel-sub h3 {
      font-size: 1.2rem;
      margin-bottom: 5px;
      color: var(--text-primary);
      margin: 0;
    }

    .input-field {
      width: 100%;
      max-width: 100%;
      padding: 10px 15px;
      border: 1px solid #333;
      outline: none;
      background-color: #222;
      color: var(--text-primary);
      font-size: 1rem;
      border-radius: var(--border-radius);
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .input-field::placeholder {
      color: var(--text-secondary);
    }

    .input-field:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(33,150,243,0.2);
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: #ffffff;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      padding: 10px 15px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .result, #dns-result, #js-error-analyzer-result, #compatibility-results, #url-result, #contrast-result, #text-analysis-result {
      margin-top: 10px;
      font-size: 0.95rem;
      color: var(--text-primary);
      word-break: break-word;
      white-space: normal;
    }

    .progress-bar-container, #mic-level-container, #battery-progress-bar-container, #storage-progress-bar-container {
      width: 100%;
      background-color: #333;
      border-radius: var(--border-radius);
      overflow: hidden;
      height: 20px;
      margin-top: 10px;
    }

    .progress-bar, #mic-level, #battery-progress-bar, #storage-progress-bar {
      width: 0%;
      height: 100%;
      background-color: var(--primary-color);
      transition: width 0.3s;
      border-radius: var(--border-radius);
    }

    #mic-level {
      background-color: var(--secondary-color);
    }

    #battery-progress-bar {
      background-color: var(--secondary-color);
    }

    #storage-progress-bar {
      background-color: var(--primary-color);
    }

    #webcam-video {
      width: 100%;
      max-height: 500px;
      background-color: #000;
      border-radius: var(--border-radius);
      display: none;
      object-fit: cover;
      margin-top: 10px;
    }

    #screen-rectangle {
      background-color: var(--secondary-color);
      width: 100px;
      height: 100px;
      margin: 0 auto;
      border-radius: var(--border-radius);
    }

    .info-table {
      width: 100%;
      border-collapse: collapse;
      word-break: break-word;
    }

    .info-table th, .info-table td {
      text-align: left;
      padding: 8px 10px;
      border-bottom: 1px solid #333;
      font-size: 0.95rem;
      word-break: break-word;
      white-space: normal;
    }

    .info-table th {
      width: 40%;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .info-table td {
      width: 60%;
      color: var(--text-primary);
    }

    ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    ul li {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: var(--text-primary);
      word-break: break-word;
      white-space: normal;
    }

    ul li i {
      margin-right: 8px;
      font-size: 1.1rem;
      color: var(--secondary-color);
    }

    .footer {
      background-color: var(--surface-color);
      color: var(--text-secondary);
      text-align: center;
      padding: 15px 30px;
      font-size: 0.9rem;
      position: relative;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      flex-wrap: wrap;
      border-top: 1px solid #333;
      z-index: 1000;
    }

    .footer a {
      color: var(--secondary-color);
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer a:hover {
      color: var(--primary-color);
    }

    .footer .visitor-count .label {
      font-weight: 500;
      margin-right: 5px;
      color: var(--text-primary);
    }

    .favorite-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--surface-color);
      border: none;
      color: var(--secondary-color);
      cursor: pointer;
      font-size: 1.4rem;
      transition: transform 0.2s, color 0.3s, box-shadow 0.3s;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    .favorite-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }

    .favorite-toggle.favorited {
      color: var(--secondary-color);
      box-shadow: inset 0 0 0 3px rgba(3,218,198,0.2);
    }

    .network-speed-chart-container {
      width: 100%;
      height: 300px;
      position: relative;
      overflow:hidden;
    }

    @media (max-width: 768px) {
      .panel-section {
        grid-template-columns: 1fr;
      }

      .top-bar {
        flex-direction: column;
        align-items: flex-start;
        height: auto;
        padding-bottom: 10px;
      }

      .top-bar .search-container {
        width: 100%;
        margin-top: 15px;
      }

      .content {
        padding: 20px;
      }

      .drawer-menu {
        width: 100%;
      }
    }
  </style>
</head>
<body>

<!-- Drawer menu with former sidebar links and now the utility buttons -->
<nav class="drawer-menu" id="drawer-menu">
<!-- Utility buttons from the hidden section moved here -->
  <div style="margin-top: 20px; padding: 0 20px; display: flex; flex-direction: column; gap: 10px;">
    <button id="copy-system-info-btn" class="btn-primary"><i class="fas fa-copy"></i> Copy System Info</button>
    <button id="clear-cookies-btn" class="btn-primary"><i class="fas fa-cookie-bite"></i> Clear Cookies</button>
    <button id="reset-app-data-btn" class="btn-primary"><i class="fas fa-sync-alt"></i> Reset App Data</button>
    <button id="reload-page-btn" class="btn-primary"><i class="fas fa-redo"></i> Reload Page</button>
    <button id="retest-connectivity-btn" class="btn-primary"><i class="fas fa-globe"></i> Retest Connectivity</button>
    <button id="retest-location-btn" class="btn-primary"><i class="fas fa-map-marker-alt"></i> Retest Location</button>
    <button id="retest-media-devices-btn" class="btn-primary"><i class="fas fa-video"></i> Retest Media Devices</button>
    <button id="retest-webrtc-btn" class="btn-primary"><i class="fas fa-network-wired"></i> Retest WebRTC</button>
  </div>
</nav>

<div class="main">
  <div class="top-bar">
    <div class="title">
      <div class="hamburger-menu" id="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div class="search-container">
      <select id="search-engine">
        <option value="google">Google</option>
        <option value="bing">Bing</option>
        <option value="duckduckgo">DuckDuckGo</option>
        <option value="brave">Brave</option>
        <option value="yahoo">Yahoo</option>
      </select>
      <input type="text" id="search-query" class="input-field" placeholder="Search the web...">
      <button id="search-button" class="btn-primary"><i class="fas fa-search"></i> Search</button>
    </div>
  </div>

  <div class="overlay" id="overlay" style="display:none;"></div>

  <div class="content" id="main-content">
    <div class="panel" id="favorites-section" style="display:none;">
      <h2><i class="fas fa-star"></i> Favorites</h2>
      <div class="panel-section" id="favorites-grid"></div>
    </div>

    <div class="panel" id="network-tools-section">
      <h2><i class="fas fa-network-wired"></i> Network Tools</h2>
      <div class="panel-section">
        <div class="panel-sub" id="ping-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-signal"></i> Ping Test</h3>
          <input type="text" id="ping-address" class="input-field" placeholder="Enter server address (e.g., example.com)">
          <button id="start-ping-test-btn" class="btn-primary"><i class="fas fa-play"></i> Start Ping Test</button>
          <canvas id="pingChart" style="margin-top: 20px; height: 150px;"></canvas>
        </div>

        <div class="panel-sub" id="internet-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-globe"></i> Internet Connectivity</h3>
          <div style="text-align: center;">
            <i id="internet-status-icon" class="fas fa-circle" style="font-size: 48px; color: #27ae60;"></i>
            <p id="internet-status-text" style="margin-top: 10px; font-size: 1.1rem;">Online</p>
          </div>
        </div>

        <div class="panel-sub network-speed-card" id="network-speed-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-chart-line"></i> Network Speed</h3>
          <div class="network-speed-chart-container">
            <canvas id="networkSpeedChart"></canvas>
          </div>
          <p id="current-speed" style="text-align: center; margin-top: 15px; font-size: 1rem; color: #27ae60;">
            Current Speed: <strong>-- Mbps</strong>
          </p>
        </div>

        <div class="panel-sub" id="network-info-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-network-wired"></i> Network Information</h3>
          <strong>Public IP Address:</strong>
          <p id="public-ip" style="margin-top: 5px; color: #27ae60;">Fetching...</p>
          <button id="refresh-ip-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-sync-alt"></i> Refresh IP</button>
          <div class="network-info" style="margin-top: 20px;">
            <strong>DNS Lookup:</strong>
            <input type="text" id="dns-domain" class="input-field" placeholder="Enter domain name (e.g., example.com)">
            <button id="dns-lookup-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-search"></i> Lookup DNS</button>
            <div class="result" id="dns-result"></div>
          </div>
        </div>

        <div class="panel-sub" id="webrtc-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-network-wired"></i> WebRTC IP Addresses</h3>
          <div id="webrtc-content" style="color: #0dcaf0;">Retrieving...</div>
        </div>
      </div>
    </div>

    <div class="panel" id="system-info-section">
      <h2><i class="fas fa-desktop"></i> System Information</h2>
      <div class="panel-section">
        <div class="panel-sub" id="system-info-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-desktop"></i> System Information</h3>
          <div id="system-info-content">
            <table class="info-table">
              <tbody>
                <tr><th>Operating System:</th><td id="os-info">Loading...</td></tr>
                <tr><th>Device Type:</th><td id="device-type-info">Loading...</td></tr>
                <tr><th>RAM:</th><td id="ram-info">Loading...</td></tr>
                <tr><th>Processor:</th><td id="processor-info">Loading...</td></tr>
                <tr><th>Disk Space:</th><td id="disk-space-info">Loading...</td></tr>
                <tr><th>Browser:</th><td id="browser-info">Loading...</td></tr>
                <tr><th>Platform:</th><td id="platform-info">Loading...</td></tr>
                <tr><th>Language:</th><td id="language-info">Loading...</td></tr>
                <tr><th>Online:</th><td id="online-status-info">Loading...</td></tr>
                <tr><th>Cookies Enabled:</th><td id="cookies-enabled-info">Loading...</td></tr>
                <tr><th>Touch Support:</th><td id="touch-support-info">Loading...</td></tr>
              </tbody>
            </table>
            <p style="font-size: 0.85rem; margin-top: 10px; color: var(--muted-text);">
              <em>Note: Disk space usage reflects browser storage quota usage, not entire system disk usage.</em>
            </p>
          </div>
        </div>

        <div class="panel-sub" id="memory-usage-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-memory"></i> Memory Usage</h3>
          <canvas id="memoryChart" style="margin-top: 20px; height: 150px;"></canvas>
        </div>

        <div class="panel-sub" id="battery-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-battery-half"></i> Battery Status</h3>
          <div class="progress-bar-container">
            <div id="battery-progress-bar" class="progress-bar"></div>
          </div>
          <p id="battery-status-text" style="margin-top: 10px; font-size: 1rem; color: #0dcaf0;">Loading...</p>
        </div>

        <div class="panel-sub" id="screen-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-tv"></i> Screen Resolution</h3>
          <div id="screen-rectangle"></div>
          <p id="screen-dimensions-text" style="text-align: center; margin-top: 10px; font-size: 1rem; color: #0dcaf0;"></p>
        </div>

        <div class="panel-sub" id="timezone-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-clock"></i> Time Zone & Locale</h3>
          <table class="info-table">
            <tbody>
              <tr><th>Time Zone:</th><td id="timezone-info">Loading...</td></tr>
              <tr><th>Locale:</th><td id="locale-info">Loading...</td></tr>
            </tbody>
          </table>
          <div id="map" style="height: 200px; margin-top: 15px; border-radius: var(--border-radius);"></div>
        </div>
      </div>
    </div>

    <div class="panel" id="device-sensors-section">
      <h2><i class="fas fa-cogs"></i> Device Sensors and Media</h2>
      <div class="panel-section">
        <div class="panel-sub" id="sensors-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-cogs"></i> Sensors Availability</h3>
          <div id="sensors-content" style="color: #0dcaf0;"></div>
        </div>

        <div class="panel-sub" id="media-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-video"></i> Media Devices</h3>
          <strong>Available Media Devices:</strong>
          <ul id="media-devices-list" style="margin-top: 10px;"></ul>
          <div class="media-test" style="margin-top: 20px;">
            <button id="toggle-webcam-btn" class="btn-primary"><i class="fas fa-camera"></i> Test Webcam</button>
            <video id="webcam-video" autoplay playsinline></video>
          </div>
          <div class="media-test" style="margin-top: 20px;">
            <button id="toggle-microphone-btn" class="btn-primary"><i class="fas fa-microphone"></i> Test Microphone</button>
            <div id="mic-level-container">
              <div id="mic-level"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel" id="security-privacy-section">
      <h2><i class="fas fa-shield-alt"></i> Security and Privacy</h2>
      <div class="panel-section">
        <div class="panel-sub" id="adblocker-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-ban"></i> Ad Blocker Detection</h3>
          <div id="adblocker-content" style="text-align: center; color: #0dcaf0;">
            Detecting...
          </div>
        </div>

        <div class="panel-sub" id="serviceworker-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-robot"></i> Service Worker Status</h3>
          <div id="serviceworker-content" style="text-align: center; color: #0dcaf0;">
            Checking...
          </div>
        </div>

        <div class="panel-sub" id="js-errors-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-exclamation-triangle"></i> JavaScript Errors</h3>
          <div id="js-errors-content" style="color: #c0392b;">
            No errors detected.
          </div>
        </div>

        <div class="panel-sub" id="js-error-analyzer-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-code"></i> JavaScript Error Analyzer</h3>
          <input type="text" id="analyzer-url" class="input-field" placeholder="Enter website URL (e.g., http://localhost:8000/testPage.html)">
          <button id="start-js-error-analysis-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-search"></i> Analyze JavaScript Errors</button>
          <div id="js-error-analyzer-result" style="margin-top: 15px;"></div>
          <iframe id="js-error-analyzer-iframe" src="" style="width: 100%; height: 0; border: none; display: none;"></iframe>
        </div>
      </div>
    </div>

    <div class="panel" id="performance-section">
      <h2><i class="fas fa-tachometer-alt"></i> Performance Monitoring</h2>
      <div class="panel-section">
        <div class="panel-sub" id="fps-monitor-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-tachometer-alt"></i> FPS Monitor</h3>
          <canvas id="performanceChart" style="margin-top: 20px; height: 150px;"></canvas>
        </div>

        <div class="panel-sub" id="webgl-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-cube"></i> WebGL Support</h3>
          <div id="webgl-content" style="text-align: center; color: #0dcaf0;">
            Checking...
          </div>
        </div>
      </div>
    </div>

    <div class="panel" id="compatibility-section">
      <h2><i class="fas fa-universal-access"></i> Compatibility</h2>
      <div class="panel-section">
        <div class="panel-sub" id="compatibility-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-browser"></i> Browser Compatibility Checker</h3>
          <p style="font-size: 0.95rem; color: var(--muted-text);">
            Check if your browser supports key modern web features.
          </p>
          <button id="run-compatibility-check" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-check"></i> Run Compatibility Check</button>
          <div id="compatibility-results" style="margin-top: 15px;"></div>
        </div>
      </div>
    </div>

    <div class="panel" id="website-tools-section">
      <h2><i class="fas fa-globe"></i> Website Tools</h2>
      <div class="panel-section">
        <div class="panel-sub" id="qr-code-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-qrcode"></i> QR Code Generator</h3>
          <input type="text" id="qr-text-input" class="input-field" placeholder="Enter text or URL...">
          <button id="generate-qr-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-qrcode"></i> Generate QR Code</button>
          <div id="qr-code" style="margin-top: 15px;"></div>
        </div>
      </div>
    </div>

    <div class="panel" id="utilities-section">
      <h2><i class="fas fa-tools"></i> Utilities</h2>
      <div class="panel-section">
        <div class="panel-sub" id="password-generator-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-key"></i> Password Generator</h3>
          <label for="password-length">Length:</label>
          <input type="number" id="password-length" class="input-field" min="4" max="64" value="12">
          <div>
            <input type="checkbox" id="include-uppercase" checked>
            <label for="include-uppercase">Include Uppercase Letters</label>
          </div>

          <div>
            <input type="checkbox" id="include-numbers" checked>
            <label for="include-numbers">Include Numbers</label>
          </div>

          <div>
            <input type="checkbox" id="include-special" checked>
            <label for="include-special">Include Special Characters</label>
          </div>

          <button id="generate-password-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-random"></i> Generate Password</button>
          <div id="generated-password" style="margin-top: 15px; word-wrap: break-word; font-size: 1rem; color: var(--accent-color);"></div>
        </div>

        <div class="panel-sub" id="unit-converter-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-exchange-alt"></i> Unit Converter</h3>
          <label for="conversion-category">Category:</label>
          <select id="conversion-category" class="input-field">
            <option value="length">Length</option>
            <option value="weight">Weight</option>
            <option value="temperature">Temperature</option>
            <option value="volume">Volume</option>
          </select>

          <label for="from-unit">From:</label>
          <select id="from-unit" class="input-field"></select>

          <label for="to-unit">To:</label>
          <select id="to-unit" class="input-field"></select>

          <label for="input-value">Value:</label>
          <input type="number" id="input-value" class="input-field" placeholder="Enter value">

          <button id="convert-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-sync-alt"></i> Convert</button>
          <div id="conversion-result" style="margin-top: 15px;"></div>
        </div>

        <div class="panel-sub" id="text-analyzer-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-align-left"></i> Text Analyzer</h3>
          <textarea id="text-input" class="input-field" rows="6" placeholder="Enter or paste your text here..."></textarea>
          <button id="analyze-text-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-chart-bar"></i> Analyze Text</button>
          <div id="text-analysis-result" style="margin-top: 15px;"></div>
        </div>

        <div class="panel-sub" id="url-encoder-decoder-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-link"></i> URL Encoder/Decoder</h3>
          <textarea id="url-input" class="input-field" rows="3" placeholder="Enter your URL here..."></textarea>
          <div style="margin-top: 10px;">
            <button id="encode-url-btn" class="btn-primary"><i class="fas fa-code"></i> Encode</button>
            <button id="decode-url-btn" class="btn-primary" style="margin-left: 10px;"><i class="fas fa-code-branch"></i> Decode</button>
          </div>
          <div id="url-result" style="margin-top: 15px; word-wrap: break-word; font-size: 1rem; color: var(--accent-color);"></div>
        </div>

        <div class="panel-sub" id="color-picker-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-palette"></i> Color Picker & Contrast Checker</h3>
          <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div>
              <label for="color1">Color 1:</label>
              <input type="color" id="color1" value="#ffffff" class="input-field" style="width: 100px; height: 50px; padding:0; border:none;">
            </div>
            <div>
              <label for="color2">Color 2:</label>
              <input type="color" id="color2" value="#000000" class="input-field" style="width: 100px; height: 50px; padding:0; border:none;">
            </div>
          </div>
          <button id="check-contrast-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-eye"></i> Check Contrast</button>
          <div id="contrast-result" style="margin-top: 15px; font-size: 1rem;"></div>
          <div style="margin-top: 20px;">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 50px; height: 50px; background-color: #ffffff; border: 1px solid #ccc;"></div>
              <div style="width: 50px; height: 50px; background-color: #000000; border: 1px solid #ccc;"></div>
            </div>
          </div>
        </div>

        <div class="panel-sub" id="calculator-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-calculator"></i> Calculator</h3>
          <input type="text" id="calculator-display" class="input-field" placeholder="0" readonly style="text-align: right; font-size: 1.2rem;">
          <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px;">
            <button class="btn-primary calc-btn" data-value="7">7</button>
            <button class="btn-primary calc-btn" data-value="8">8</button>
            <button class="btn-primary calc-btn" data-value="9">9</button>
            <button class="btn-primary calc-btn" data-value="/">/</button>

            <button class="btn-primary calc-btn" data-value="4">4</button>
            <button class="btn-primary calc-btn" data-value="5">5</button>
            <button class="btn-primary calc-btn" data-value="6">6</button>
            <button class="btn-primary calc-btn" data-value="*">*</button>

            <button class="btn-primary calc-btn" data-value="1">1</button>
            <button class="btn-primary calc-btn" data-value="2">2</button>
            <button class="btn-primary calc-btn" data-value="3">3</button>
            <button class="btn-primary calc-btn" data-value="-">-</button>

            <button class="btn-primary calc-btn" data-value="0">0</button>
            <button class="btn-primary calc-btn" data-value=".">.</button>
            <button class="btn-primary calc-btn" id="clear-btn">C</button>
            <button class="btn-primary calc-btn" data-value="+">+</button>

            <button class="btn-primary calc-btn" style="grid-column: span 4; background-color: var(--accent-color);" id="equals-btn">=</button>
          </div>
        </div>

        <div class="panel-sub" id="todo-list-card">
          <button class="favorite-toggle" aria-label="Favorite Toggle"><i class="fas fa-star"></i></button>
          <h3><i class="fas fa-tasks"></i> To-Do List</h3>
          <input type="text" id="todo-input" class="input-field" placeholder="Add a new task...">
          <button id="add-todo-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-plus"></i> Add Task</button>
          <ul id="todo-list" style="margin-top: 15px;"></ul>
        </div>
      </div>
    </div>

    <div style="display:none;">
      <button id="copy-system-info-btn"><i class="fas fa-copy"></i> Copy System Info</button>
      <button id="clear-cookies-btn"><i class="fas fa-cookie-bite"></i> Clear Cookies</button>
      <button id="reset-app-data-btn"><i class="fas fa-sync-alt"></i> Reset App Data</button>
      <button id="reload-page-btn"><i class="fas fa-redo"></i> Reload Page</button>
      <button id="retest-connectivity-btn"><i class="fas fa-globe"></i> Retest Connectivity</button>
      <button id="retest-location-btn"><i class="fas fa-map-marker-alt"></i> Retest Location</button>
      <button id="retest-media-devices-btn"><i class="fas fa-video"></i> Retest Media Devices</button>
      <button id="retest-webrtc-btn"><i class="fas fa-network-wired"></i> Retest WebRTC</button>
    </div>
  </div>

    <div class="footer">
      <span>© 2024-2025 Michael Palmero</span>
      <a href="https://buymeacoffee.com/mpalmero" target="_blank"><i class="fas fa-coffee"></i> Buy me a coffee?</a>
      <div class="visitor-count">
        <span class="label">Visitors:</span> <span id="visitor-count">0</span>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
  // Toggle drawer menu functionality
  const hamburgerMenu = document.getElementById('hamburger-menu');
  const drawerMenu = document.getElementById('drawer-menu');

  hamburgerMenu.addEventListener('click', () => {
    drawerMenu.classList.toggle('open');
  });

    let errorLogs = [];

    window.onerror = function(message, source, lineno, colno, error) {
      const errorMessage = `${message} at ${source}:${lineno}:${colno}`;
      errorLogs.push(errorMessage);
      updateJsErrors();
      return false;
    };

    const originalLocations = new Map(); 
    const favoritesGrid = document.getElementById('favorites-grid');
    const favoritesSection = document.getElementById('favorites-section');

    function toggleFavorite(card) {
      const favBtn = card.querySelector('.favorite-toggle');
      const isFavorite = favBtn.classList.contains('favorited');
      
      if (isFavorite) {
        favBtn.classList.remove('favorited');
        const originalParent = originalLocations.get(card.id);
        if (originalParent) {
          originalParent.appendChild(card);
        }
      } else {
        favBtn.classList.add('favorited');
        if (!originalLocations.has(card.id)) {
          originalLocations.set(card.id, card.parentNode);
        }
        favoritesGrid.appendChild(card);
      }

      updateFavoritesVisibility();
    }

    function updateFavoritesVisibility() {
      const hasFavorites = favoritesGrid.children.length > 0;
      favoritesSection.style.display = hasFavorites ? 'block' : 'none';
    }

    window.addEventListener('load', () => {
      document.querySelectorAll('.panel-sub').forEach(card => {
        const favBtn = card.querySelector('.favorite-toggle');
        if (favBtn) {
          favBtn.addEventListener('click', () => toggleFavorite(card));
        }
      });
    });

    function updateVisitorCount() {
      const visitorCountElement = document.getElementById('visitor-count');
      let count = localStorage.getItem('visitorCount');
      if (count === null) {
        count = 1;
      } else {
        count = parseInt(count) + 1;
      }
      localStorage.setItem('visitorCount', count);
      visitorCountElement.innerText = count;
    }

    function copySystemInfo() {
      const systemInfoContentElement = document.getElementById('system-info-content');
      if (!systemInfoContentElement) {
        alert('System information content not found.');
        return;
      }
      const systemInfoContent = systemInfoContentElement.innerText;
      navigator.clipboard.writeText(systemInfoContent).then(() => {
        alert('System information copied to clipboard.');
      }, () => {
        alert('Failed to copy system information.');
      });
    }

    function clearCookies() {
      document.cookie.split(";").forEach(function(c) {
        document.cookie = c.trim().startsWith("=") ? c : c.replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
      });
      alert('Cookies cleared.');
    }

    function resetAppData() {
      let count = localStorage.getItem('visitorCount');
      const keys = Object.keys(localStorage);
      for (let i=0; i<keys.length; i++) {
        if (keys[i] !== 'visitorCount') {
          localStorage.removeItem(keys[i]);
        }
      }
      if (count !== null) {
        localStorage.setItem('visitorCount', count);
        document.getElementById('visitor-count').innerText = count;
      }
      sessionStorage.clear();
      clearCookies();
      alert('Application data reset. Reloading page...');
      reloadPage();
    }

    function reloadPage() {
      location.reload();
    }

    function updateJsErrors() {
      const jsErrorsContent = document.getElementById('js-errors-content');
      if (jsErrorsContent) {
        if (errorLogs.length > 0) {
          jsErrorsContent.innerHTML = `<strong>Errors Detected (${errorLogs.length}):</strong><br>${errorLogs.join('<br>')}`;
        } else {
          jsErrorsContent.innerHTML = 'No errors detected.';
        }
      }
    }

    function getOS(userAgent) {
      if (userAgent.indexOf("Win") !== -1) return "Windows";
      if (userAgent.indexOf("Mac") !== -1) return "macOS";
      if (userAgent.indexOf("X11") !== -1) return "UNIX";
      if (userAgent.indexOf("Linux") !== -1) return "Linux";
      return "Unknown";
    }

    function getDeviceType() {
      const ua = navigator.userAgent;
      if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
        return "Mobile";
      }
      return "Desktop";
    }

    function updateSystemInfo() {
      const osInfo = document.getElementById('os-info');
      const deviceTypeInfo = document.getElementById('device-type-info');
      const ramInfo = document.getElementById('ram-info');
      const processorInfo = document.getElementById('processor-info');
      const diskSpaceInfo = document.getElementById('disk-space-info');
      const browserInfo = document.getElementById('browser-info');
      const platformInfo = document.getElementById('platform-info');
      const languageInfo = document.getElementById('language-info');
      const onlineStatusInfo = document.getElementById('online-status-info');
      const cookiesEnabledInfo = document.getElementById('cookies-enabled-info');
      const touchSupportInfo = document.getElementById('touch-support-info');

      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const language = navigator.language;
      const onlineStatus = navigator.onLine ? "Yes" : "No";
      const cookiesEnabled = navigator.cookieEnabled ? "Yes" : "No";
      const touchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0 ? "Yes" : "No";
      const os = getOS(userAgent);
      const ram = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Not Available";
      const processor = navigator.hardwareConcurrency ? `${navigator.hardwareConcurrency} Logical Processor(s)` : "Not Available";
      const deviceType = getDeviceType();

      osInfo.innerText = os;
      deviceTypeInfo.innerText = deviceType;
      ramInfo.innerText = ram;
      processorInfo.innerText = processor;
      browserInfo.innerText = userAgent;
      platformInfo.innerText = platform;
      languageInfo.innerText = language;
      onlineStatusInfo.innerText = onlineStatus;
      cookiesEnabledInfo.innerText = cookiesEnabled;
      touchSupportInfo.innerText = touchSupport;

      if (navigator.storage && navigator.storage.estimate) {
        navigator.storage.estimate().then(estimate => {
          const used = estimate.usage || 0;
          const quota = estimate.quota || 1;
          const usedPercentage = ((used / quota) * 100).toFixed(2);
          const usedMB = (used / (1024 * 1024)).toFixed(2);
          const quotaMB = (quota / (1024 * 1024)).toFixed(2);
          diskSpaceInfo.innerText = `Used: ${usedMB} MB / Total: ${quotaMB} MB (${usedPercentage}%)`;
        }).catch(() => {
          diskSpaceInfo.innerText = 'Not Available';
        });
      } else {
        diskSpaceInfo.innerText = 'Not Available';
      }
    }

    function updateInternetConnectivity() {
      const internetStatusIcon = document.getElementById('internet-status-icon');
      const internetStatusText = document.getElementById('internet-status-text');
      fetch('https://www.google.com/', { mode: 'no-cors' })
        .then(() => {
          internetStatusIcon.style.color = '#27ae60';
          internetStatusText.innerHTML = 'Online';
        })
        .catch(() => {
          internetStatusIcon.style.color = '#c0392b';
          internetStatusText.innerHTML = 'Offline';
        });
    }

    let fpsData = [];
    let fpsTimestamps = [];

    function updateFPSChart() {
      const now = performance.now();
      while (fpsTimestamps.length > 0 && fpsTimestamps[0] <= now - 1000) {
        fpsTimestamps.shift();
      }
      fpsTimestamps.push(now);
      const fps = fpsTimestamps.length;
      fpsData.push(fps);
      if (fpsData.length > 30) {
        fpsData.shift();
      }

      const maxFPS = Math.max(...fpsData);
      const nextHundred = Math.ceil(maxFPS / 100) * 100 || 100;
      fpsChart.options.scales.y.max = nextHundred;

      fpsChart.data.datasets[0].data = fpsData;
      fpsChart.update();
    }

    function trackFPS() {
      requestAnimationFrame(() => {
        updateFPSChart();
        trackFPS();
      });
    }

    const fpsCtx = document.getElementById('performanceChart').getContext('2d');
    const fpsChart = new Chart(fpsCtx, {
      type: 'line',
      data: {
        labels: Array(30).fill(''),
        datasets: [{
          label: 'FPS',
          data: fpsData,
          backgroundColor: 'rgba(27, 86, 255, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 0,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, title: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
    trackFPS();

    async function measureNetworkSpeed() {
      try {
        const startTime = performance.now();
        const response = await fetch('https://speed.hetzner.de/10MB.bin', { cache: 'no-cache' });
        if (!response.ok) {
          throw new Error(`Network response was not ok (${response.status})`);
        }
        const reader = response.body.getReader();
        let receivedLength = 0;
        while(true) {
          const {done, value} = await reader.read();
          if (done) break;
          receivedLength += value.length;
        }
        const endTime = performance.now();
        const durationInSeconds = (endTime - startTime) / 1000;
        const bitsLoaded = receivedLength * 8;
        const speedBps = bitsLoaded / durationInSeconds;
        const speedMbps = (speedBps / (1024 * 1024)).toFixed(2);
        return speedMbps;
      } catch {
        return null;
      }
    }

    let networkSpeedData = [];
    const networkSpeedCtx = document.getElementById('networkSpeedChart').getContext('2d');
    const networkSpeedChart = new Chart(networkSpeedCtx, {
      type: 'line',
      data: {
        labels: Array(10).fill(''),
        datasets: [{
          label: 'Speed (Mbps)',
          data: networkSpeedData,
          backgroundColor: 'rgba(27, 86, 255, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 3,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, suggestedMax: 100, title: { display: true, text: 'Mbps' }, grid: { color: '#333' } }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                return `Speed: ${context.parsed.y} Mbps`;
              }
            }
          }
        }
      }
    });

    async function updateNetworkSpeedChart() {
      const speedMbps = await measureNetworkSpeed();
      const currentSpeedElement = document.getElementById('current-speed');
      if (speedMbps !== null) {
        networkSpeedData.push(speedMbps);
        if (networkSpeedData.length > 10) {
          networkSpeedData.shift();
          networkSpeedChart.data.labels.shift();
        }
        networkSpeedChart.data.datasets[0].data = networkSpeedData;
        networkSpeedChart.update();
        currentSpeedElement.innerHTML = `Current Speed: <strong>${speedMbps} Mbps</strong>`;
        currentSpeedElement.style.color = '#27ae60';
      } else {
        currentSpeedElement.innerHTML = `Current Speed: <strong>-- Mbps</strong>`;
        currentSpeedElement.style.color = '#c0392b';
      }
    }
    updateNetworkSpeedChart();
    setInterval(updateNetworkSpeedChart, 60000);

    function updateBatteryStatus() {
      const batteryProgressBar = document.getElementById('battery-progress-bar');
      const batteryStatusText = document.getElementById('battery-status-text');
      if (navigator.getBattery) {
        navigator.getBattery().then(battery => {
          const batteryLevel = (battery.level * 100).toFixed(0);
          const chargingStatus = battery.charging ? "Charging" : "Not Charging";
          batteryProgressBar.style.width = `${batteryLevel}%`;
          batteryProgressBar.style.backgroundColor = battery.charging ? '#0dcaf0' : '#27ae60';
          batteryStatusText.innerHTML = `${batteryLevel}% - ${chargingStatus}`;
          batteryStatusText.style.color = battery.charging ? '#0dcaf0' : '#27ae60';
        });
      } else {
        batteryStatusText.innerHTML = "Battery status not supported by your browser.";
      }
    }

    function updateScreenResolution() {
      const screenRectangle = document.getElementById('screen-rectangle');
      const screenDimensionsText = document.getElementById('screen-dimensions-text');
      const width = window.screen.width;
      const height = window.screen.height;
      const maxDimension = Math.max(width, height);
      const scaledWidth = (width / maxDimension) * 280;
      const scaledHeight = (height / maxDimension) * 280;
      screenRectangle.style.width = `${scaledWidth}px`;
      screenRectangle.style.height = `${scaledHeight}px`;
      screenDimensionsText.innerHTML = `<strong>${width}px</strong> x <strong>${height}px</strong>`;
    }

    let mapInitialized = false;
    let mapInstance;
    function updateLocation() {
      const mapDiv = document.getElementById('map');
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const { latitude, longitude } = position.coords;
            if (mapDiv) {
              if (!mapInitialized) {
                mapInstance = L.map('map').setView([latitude, longitude], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                  attribution: '&copy; OpenStreetMap contributors'
                }).addTo(mapInstance);
                L.marker([latitude, longitude]).addTo(mapInstance)
                  .bindPopup('You are here.')
                  .openPopup();
                mapInitialized = true;
              } else {
                mapInstance.setView([latitude, longitude], 13);
                L.marker([latitude, longitude]).addTo(mapInstance)
                  .bindPopup('You are here.')
                  .openPopup();
              }
            }
          },
          () => {
            if (mapDiv) {
              mapDiv.innerHTML = "<p style='color: #c0392b;'>Location access denied.</p>";
            }
          }
        );
      } else {
        if (mapDiv) {
          mapDiv.innerHTML = "<p style='color: #c0392b;'>Geolocation not supported.</p>";
        }
      }
    }

    function updateTimeZone() {
      const timezoneInfo = document.getElementById('timezone-info');
      const localeInfo = document.getElementById('locale-info');
      const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const locale = navigator.language;
      timezoneInfo.innerText = timeZone;
      localeInfo.innerText = locale;
    }

    let memoryUsageData = [];
    function updateMemoryUsage() {
      const memoryUsage = performance.memory ? (performance.memory.usedJSHeapSize / 1048576).toFixed(2) : null;
      if (memoryUsage !== null) {
        memoryUsageData.push(memoryUsage);
        if (memoryUsageData.length > 30) {
          memoryUsageData.shift();
        }
        memoryChart.data.datasets[0].data = memoryUsageData;
        memoryChart.update();
      }
    }

    const memoryCtx = document.getElementById('memoryChart').getContext('2d');
    const memoryChart = new Chart(memoryCtx, {
      type: 'line',
      data: {
        labels: Array(30).fill(''),
        datasets: [{
          label: 'Memory Usage (MB)',
          data: memoryUsageData,
          backgroundColor: 'rgba(27, 86, 255, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 0,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, title: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
    setInterval(updateMemoryUsage, 1000);

    function updateSensorsAvailability() {
      const sensorsContent = document.getElementById('sensors-content');
      const sensors = [];
      if ('Accelerometer' in window) sensors.push('<li><i class="fas fa-check-circle" style="color: #27ae60;"></i> Accelerometer</li>');
      if ('Gyroscope' in window) sensors.push('<li><i class="fas fa-check-circle" style="color: #27ae60;"></i> Gyroscope</li>');
      if ('Magnetometer' in window) {
        sensors.push('<li><i class="fas fa-check-circle" style="color: #27ae60;"></i> Magnetometer</li>');
      } else {
        sensors.push('<li><i class="fas fa-times-circle" style="color: #c0392b;"></i> Magnetometer</li>');
      }
      if (sensors.length > 0) {
        sensorsContent.innerHTML = `<ul>${sensors.join('')}</ul>`;
      } else {
        sensorsContent.innerHTML = "<p>No motion sensors available.</p>";
      }
    }

    function updateMediaDevices() {
      const mediaDevicesList = document.getElementById('media-devices-list');
      if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
        navigator.mediaDevices.enumerateDevices().then(devices => {
          const deviceList = devices.map(device => {
            let icon = '';
            if (device.kind === 'audioinput') icon = '<i class="fas fa-microphone" style="color: var(--accent-color);"></i>';
            if (device.kind === 'audiooutput') icon = '<i class="fas fa-volume-up" style="color: var(--accent-color);"></i>';
            if (device.kind === 'videoinput') icon = '<i class="fas fa-video" style="color: var(--accent-color);"></i>';
            return `<li>${icon} ${device.label || 'Not Named'}</li>`;
          }).join('');
          mediaDevicesList.innerHTML = `<ul>${deviceList}</ul>`;
        }).catch(err => {
          console.error('Error accessing media devices:', err);
          mediaDevicesList.innerHTML = "<p style='color: #c0392b;'>Could not access media devices.</p>";
        });
      } else {
        mediaDevicesList.innerHTML = "<p style='color: #c0392b;'>Media Devices API not supported.</p>";
      }
    }

    function checkWebGLSupport() {
      const webglContent = document.getElementById('webgl-content');
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if (gl && gl instanceof WebGLRenderingContext) {
        webglContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #27ae60;"></i><br><p>WebGL is supported.</p>';
      } else {
        webglContent.innerHTML = '<i class="fas fa-times-circle" style="font-size: 48px; color: #c0392b;"></i><br><p>WebGL is not supported.</p>';
      }
    }

    function detectAdBlocker() {
      const adblockerContent = document.getElementById('adblocker-content');
      const ad = document.createElement('div');
      ad.innerHTML = '&nbsp;';
      ad.className = 'adsbox';
      ad.style.position = 'absolute';
      ad.style.top = '-9999px';
      document.body.appendChild(ad);
      window.setTimeout(() => {
        if (ad.offsetHeight === 0) {
          adblockerContent.innerHTML = '<i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #f39c12;"></i><br><p>Ad blocker detected.</p>';
        } else {
          adblockerContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #27ae60;"></i><br><p>No ad blocker detected.</p>';
        }
        ad.remove();
      }, 100);
    }

    function checkServiceWorkerStatus() {
      const serviceworkerContent = document.getElementById('serviceworker-content');
      if ('serviceWorker' in navigator) {
        if (navigator.serviceWorker.controller) {
          serviceworkerContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #27ae60;"></i><br><p>Service Worker is active.</p>';
        } else {
          serviceworkerContent.innerHTML = '<i class="fas fa-info-circle" style="font-size: 48px; color: #0dcaf0;"></i><br><p>Service Worker is supported but not registered.</p>';
        }
      } else {
        serviceworkerContent.innerHTML = '<i class="fas fa-times-circle" style="font-size: 48px; color: #c0392b;"></i><br><p>Service Workers are not supported.</p>';
      }
    }

    function getWebRTCIpAddresses() {
      const webrtcContent = document.getElementById('webrtc-content');
      const RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
      if (!RTCPeerConnection) {
        webrtcContent.innerHTML = "<p style='color: #c0392b;'>WebRTC not supported.</p>";
        return;
      }
      const pc = new RTCPeerConnection({ iceServers: [] });
      pc.createDataChannel("");
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .catch(err => {
          console.error('Error creating offer:', err);
        });
      const ips = new Set();
      pc.onicecandidate = event => {
        if (event.candidate) {
          const candidate = event.candidate.candidate;
          const regex = /([0-9]{1,3}\.){3}[0-9]{1,3}/;
          const match = candidate.match(regex);
          if (match) {
            ips.add(match[0]);
          }
        } else {
          if (ips.size > 0) {
            webrtcContent.innerHTML = `<strong>IP Addresses:</strong><br>${Array.from(ips).join('<br>')}`;
            webrtcContent.style.color = '#0dcaf0';
          } else {
            webrtcContent.innerHTML = "<p style='color: #c0392b;'>No IP addresses detected.</p>";
          }
          pc.close();
        }
      };
    }

    function startPingTest(event) {
      event.preventDefault();
      const addressInput = document.getElementById('ping-address');
      const address = addressInput.value.trim();
      if (!address) {
        alert('Please enter a server address.');
        return;
      }
      if (pingChartInstance) {
        pingChartInstance.destroy();
        pingChartInstance = null;
      }
      const pingCtx = document.getElementById('pingChart').getContext('2d');
      pingChartInstance = new Chart(pingCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Ping (ms)',
            data: [],
            backgroundColor: 'rgba(27, 86, 255, 0.2)',
            borderColor: 'var(--primary-color)',
            borderWidth: 2,
            fill: true,
            pointRadius: 3,
            tension: 0.1
          }]
        },
        options: {
          animation: false,
          scales: {
            x: { display: true, title: { display: true, text: 'Ping Number' }, grid: { color: '#333' } },
            y: { beginAtZero: true, title: { display: true, text: 'Latency (ms)' }, suggestedMax: 1000, grid: { color: '#333' } }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Latency: ${context.parsed.y} ms`;
                }
              }
            }
          }
        }
      });
      let count = 0;
      function ping() {
        const startTime = Date.now();
        const img = new Image();
        img.onload = () => {
          const endTime = Date.now();
          const latency = endTime - startTime;
          pingChartInstance.data.labels.push(count + 1);
          pingChartInstance.data.datasets[0].data.push(latency);
          pingChartInstance.update();
          count++;
          if (count < 10) {
            setTimeout(ping, 1000);
          }
        };
        img.onerror = () => {
          pingChartInstance.data.labels.push(count + 1);
          pingChartInstance.data.datasets[0].data.push(null);
          pingChartInstance.update();
          count++;
          if (count < 10) {
            setTimeout(ping, 1000);
          }
        };
        img.src = `https://${address}/favicon.ico?cache=${Math.random()}`;
      }
      ping();
    }

    let pingChartInstance = null;

    function performWebSearch(event) {
      event.preventDefault();
      const searchEngine = document.getElementById('search-engine').value;
      const query = document.getElementById('search-query').value.trim();
      if (!query) {
        alert('Please enter a search query.');
        return;
      }
      let searchURL = '';
      switch(searchEngine) {
        case 'google':
          searchURL = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
          break;
        case 'bing':
          searchURL = `https://www.bing.com/search?q=${encodeURIComponent(query)}`;
          break;
        case 'duckduckgo':
          searchURL = `https://duckduckgo.com/?q=${encodeURIComponent(query)}`;
          break;
        case 'brave':
          searchURL = `https://search.brave.com/search?q=${encodeURIComponent(query)}`;
          break;
        case 'yahoo':
          searchURL = `https://search.yahoo.com/search?p=${encodeURIComponent(query)}`;
          break;
        default:
          alert('Invalid search engine selected.');
          return;
      }
      window.open(searchURL, '_blank');
    }

    function startJsErrorAnalysis() {
      const analyzerUrlInput = document.getElementById('analyzer-url');
      const url = analyzerUrlInput.value.trim();
      const resultDiv = document.getElementById('js-error-analyzer-result');
      const iframe = document.getElementById('js-error-analyzer-iframe');
      if (!url) {
        alert('Please enter a website URL.');
        return;
      }
      try {
        new URL(url);
      } catch (e) {
        alert('Please enter a valid URL.');
        return;
      }
      resultDiv.innerHTML = 'Analyzing...';
      iframe.style.display = 'none';
      iframe.src = '';
      iframe.src = url;
      iframe.style.display = 'none';
      iframe.onload = function() {
        try {
          const iframeWindow = iframe.contentWindow;
          void iframeWindow.location.href;
          iframeWindow.onerror = function(message, source, lineno, colno, error) {
            iframeWindow.postMessage({
              type: 'js-error',
              error: { message: message, source: source, lineno: lineno, colno: colno }
            }, '*');
          };
          window.addEventListener('message', function messageHandler(event) {
            if (event.source !== iframeWindow) return;
            if (event.data.type === 'js-error') {
              displayJsError(event.data.error);
            }
          });
          resultDiv.innerHTML = '<p style="color: #27ae60;">No JavaScript errors detected.</p>';
        } catch (e) {
          resultDiv.innerHTML = '<p style="color: #c0392b;">Unable to analyze JavaScript errors due to cross-origin restrictions. Please ensure the URL is same-origin or use a local server.</p>';
          console.error('Cross-origin error:', e);
        }
      };
      function displayJsError(error) {
        if (resultDiv.innerHTML === 'Analyzing...') {
          resultDiv.innerHTML = `<strong style="color: #c0392b;">Errors Detected:</strong><br>`;
        }
        resultDiv.innerHTML += `<span style="color: #c0392b;">${error.message}</span> at <span style="color: var(--muted-text);">${error.source}:${error.lineno}:${error.colno}</span><br>`;
      }
    }

    let webcamStream = null;
    function toggleWebcam(event) {
      event.preventDefault();
      const videoElement = document.getElementById('webcam-video');
      const button = event.currentTarget;
      if (webcamStream) {
        webcamStream.getTracks().forEach(track => track.stop());
        webcamStream = null;
        videoElement.srcObject = null;
        videoElement.style.display = 'none';
        button.innerHTML = '<i class="fas fa-camera"></i> Test Webcam';
      } else {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            webcamStream = stream;
            videoElement.srcObject = stream;
            videoElement.style.display = 'block';
            button.innerHTML = '<i class="fas fa-camera-slash"></i> Stop Webcam';
          })
          .catch(err => {
            alert('Unable to access the webcam: ' + err.message);
            console.error('Webcam access error:', err);
          });
      }
    }

    let micStream = null;
    let audioContext = null;
    let analyserMic = null;
    let microphoneSource = null;
    let javascriptNodeMic = null;
    function toggleMicrophone(event) {
      event.preventDefault();
      const micLevel = document.getElementById('mic-level');
      const button = event.currentTarget;
      if (micStream) {
        micStream.getTracks().forEach(track => track.stop());
        micStream = null;
        if (audioContext) {
          audioContext.close();
          audioContext = null;
        }
        micLevel.style.width = '0%';
        button.innerHTML = '<i class="fas fa-microphone"></i> Test Microphone';
      } else {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            micStream = stream;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyserMic = audioContext.createAnalyser();
            microphoneSource = audioContext.createMediaStreamSource(stream);
            javascriptNodeMic = audioContext.createScriptProcessor(2048, 1, 1);
            analyserMic.smoothingTimeConstant = 0.8;
            analyserMic.fftSize = 1024;
            microphoneSource.connect(analyserMic);
            analyserMic.connect(javascriptNodeMic);
            javascriptNodeMic.connect(audioContext.destination);
            javascriptNodeMic.onaudioprocess = function() {
              const array = new Uint8Array(analyserMic.frequencyBinCount);
              analyserMic.getByteFrequencyData(array);
              let values = 0;
              const length = array.length;
              for (let i = 0; i < length; i++) {
                values += array[i];
              }
              const average = values / length;
              const percentage = Math.min(100, Math.max(0, average));
              micLevel.style.width = `${percentage}%`;
            };
            button.innerHTML = '<i class="fas fa-microphone-slash"></i> Stop Microphone';
          })
          .catch(err => {
            alert('Unable to access the microphone: ' + err.message);
            console.error('Microphone access error:', err);
          });
      }
    }

    function updatePublicIP() {
      const publicIPElement = document.getElementById('public-ip');
      publicIPElement.innerHTML = 'Fetching...';
      publicIPElement.style.color = '#27ae60';
      fetch('https://api.ipify.org?format=json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Network response was not ok (${response.status})`);
          }
          return response.json();
        })
        .then(data => {
          publicIPElement.innerHTML = data.ip;
          publicIPElement.style.color = '#27ae60';
        })
        .catch(err => {
          publicIPElement.innerHTML = 'Unable to fetch IP.';
          publicIPElement.style.color = '#c0392b';
          console.error('Public IP fetch error:', err);
        });
    }

    function performDNSLookup() {
      const domainInput = document.getElementById('dns-domain');
      const domain = domainInput.value.trim();
      const resultDiv = document.getElementById('dns-result');
      if (!domain) {
        alert('Please enter a domain name.');
        return;
      }
      resultDiv.innerHTML = 'Looking up...';
      resultDiv.style.color = '#0dcaf0';
      fetch(`https://dns.google/resolve?name=${encodeURIComponent(domain)}&type=A`, {
        method: 'GET',
        headers: { 'Accept': 'application/dns-json' }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Network response was not ok (${response.status})`);
        }
        return response.json();
      })
      .then(data => {
        if (data.Status === 0 && data.Answer) {
          const ips = data.Answer.filter(record => record.type === 1).map(record => record.data);
          if (ips.length > 0) {
            resultDiv.innerHTML = `<strong>A Records:</strong><br>${ips.join('<br>')}`;
            resultDiv.style.color = '#27ae60';
          } else {
            resultDiv.innerHTML = 'No A records found.';
            resultDiv.style.color = '#c0392b';
          }
        } else {
          resultDiv.innerHTML = 'DNS lookup failed or no records found.';
          resultDiv.style.color = '#c0392b';
        }
      })
      .catch(err => {
        resultDiv.innerHTML = 'Error performing DNS lookup.';
        resultDiv.style.color = '#c0392b';
        console.error('DNS lookup error:', err);
      });
    }

    function runCompatibilityCheck() {
      const resultsDiv = document.getElementById('compatibility-results');
      resultsDiv.innerHTML = 'Checking...';
      resultsDiv.style.color = '#0dcaf0';

      const features = {
        'Service Workers': 'serviceWorker' in navigator,
        'WebAssembly': typeof WebAssembly === 'object',
        'Web Components (customElements)': 'customElements' in window,
        'Intersection Observer': 'IntersectionObserver' in window,
        'Fetch API': 'fetch' in window
      };

      let report = `<strong>Browser Compatibility Report:</strong><br>`;
      for (const [feature, supported] of Object.entries(features)) {
        report += `${feature}: ${supported ? '<span style="color: #27ae60;">Supported</span>' : '<span style="color: #c0392b;">Not Supported</span>'}<br>`;
      }
      resultsDiv.innerHTML = report;
    }

    function generatePassword(length, includeUpper, includeNumbers, includeSpecial) {
      const lowercase = 'abcdefghijklmnopqrstuvwxyz';
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      const special = '!@#$%^&*()_+~`|}{[]:;?><,./-=';
      
      let characters = lowercase;
      if (includeUpper) characters += uppercase;
      if (includeNumbers) characters += numbers;
      if (includeSpecial) characters += special;
      
      let password = '';
      for (let i = 0; i < length; i++) {
        password += characters.charAt(Math.floor(Math.random() * characters.length));
      }
      return password;
    }
    
    document.getElementById('generate-password-btn').addEventListener('click', () => {
      const length = parseInt(document.getElementById('password-length').value);
      const includeUpper = document.getElementById('include-uppercase').checked;
      const includeNumbers = document.getElementById('include-numbers').checked;
      const includeSpecial = document.getElementById('include-special').checked;
      
      if (length < 4) {
        alert('Password length should be at least 4 characters.');
        return;
      }
      
      const password = generatePassword(length, includeUpper, includeNumbers, includeSpecial);
      document.getElementById('generated-password').innerText = password;
    });

    const units = {
      length: ['Meters', 'Kilometers', 'Miles', 'Yards', 'Feet', 'Inches'],
      weight: ['Kilograms', 'Grams', 'Pounds', 'Ounces'],
      temperature: ['Celsius', 'Fahrenheit', 'Kelvin'],
      volume: ['Liters', 'Milliliters', 'Gallons', 'Cups']
    };

    const conversionRates = {
      length: {
        Meters: 1,
        Kilometers: 0.001,
        Miles: 0.000621371,
        Yards: 1.09361,
        Feet: 3.28084,
        Inches: 39.3701
      },
      weight: {
        Kilograms: 1,
        Grams: 1000,
        Pounds: 2.20462,
        Ounces: 35.274
      },
      temperature: {
        Celsius: 'Celsius',
        Fahrenheit: 'Fahrenheit',
        Kelvin: 'Kelvin'
      },
      volume: {
        Liters: 1,
        Milliliters: 1000,
        Gallons: 0.264172,
        Cups: 4.22675
      }
    };

    function populateUnits() {
      const category = document.getElementById('conversion-category').value;
      const fromUnit = document.getElementById('from-unit');
      const toUnit = document.getElementById('to-unit');
      
      fromUnit.innerHTML = '';
      toUnit.innerHTML = '';
      
      units[category].forEach(unit => {
        const option1 = document.createElement('option');
        option1.value = unit;
        option1.text = unit;
        fromUnit.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = unit;
        option2.text = unit;
        toUnit.appendChild(option2);
      });
    }

    document.getElementById('conversion-category').addEventListener('change', populateUnits);
    window.addEventListener('load', populateUnits);

    function convertUnits() {
      const category = document.getElementById('conversion-category').value;
      const fromUnit = document.getElementById('from-unit').value;
      const toUnit = document.getElementById('to-unit').value;
      const value = parseFloat(document.getElementById('input-value').value);
      
      if (isNaN(value)) {
        alert('Please enter a valid number.');
        return;
      }
      
      let result;
      
      if (category === 'temperature') {
        if (fromUnit === 'Celsius') {
          if (toUnit === 'Fahrenheit') {
            result = (value * 9/5) + 32;
          } else if (toUnit === 'Kelvin') {
            result = value + 273.15;
          } else {
            result = value;
          }
        } else if (fromUnit === 'Fahrenheit') {
          if (toUnit === 'Celsius') {
            result = (value - 32) * 5/9;
          } else if (toUnit === 'Kelvin') {
            result = ((value - 32) * 5/9) + 273.15;
          } else {
            result = value;
          }
        } else if (fromUnit === 'Kelvin') {
          if (toUnit === 'Celsius') {
            result = value - 273.15;
          } else if (toUnit === 'Fahrenheit') {
            result = ((value - 273.15) * 9/5) + 32;
          } else {
            result = value;
          }
        }
      } else {
        const fromRate = conversionRates[category][fromUnit];
        const toRate = conversionRates[category][toUnit];
        result = (value * toRate) / fromRate;
      }
      
      document.getElementById('conversion-result').innerText = `${value} ${fromUnit} = ${result.toFixed(4)} ${toUnit}`;
    }

    document.getElementById('convert-btn').addEventListener('click', convertUnits);

    function analyzeText(text) {
      const words = text.trim().split(/\s+/).filter(word => word.length > 0);
      const wordCount = words.length;
      const charCount = text.length;
      const sentences = text.split(/[.!?]+/).filter(sentence => sentence.trim().length > 0);
      const sentenceCount = sentences.length;
      const readingTime = (wordCount / 200).toFixed(2);
      
      const frequency = {};
      words.forEach(word => {
        const normalized = word.toLowerCase().replace(/[^a-z0-9]/g, '');
        if (normalized) {
          frequency[normalized] = (frequency[normalized] || 0) + 1;
        }
      });
      
      const sortedWords = Object.entries(frequency).sort((a, b) => b[1] - a[1]);
      const topKeywords = sortedWords.slice(0, 5).map(entry => `${entry[0]} (${entry[1]})`).join(', ');
      
      return `
        <strong>Word Count:</strong> ${wordCount}<br>
        <strong>Character Count:</strong> ${charCount}<br>
        <strong>Sentence Count:</strong> ${sentenceCount}<br>
        <strong>Estimated Reading Time:</strong> ${readingTime} minutes<br>
        <strong>Top Keywords:</strong> ${topKeywords || 'N/A'}
      `;
    }

    document.getElementById('analyze-text-btn').addEventListener('click', () => {
      const text = document.getElementById('text-input').value;
      if (!text.trim()) {
        alert('Please enter some text to analyze.');
        return;
      }
      const analysis = analyzeText(text);
      document.getElementById('text-analysis-result').innerHTML = analysis;
    });

    function encodeURL(url) {
      try {
        return encodeURIComponent(url);
      } catch {
        return 'Invalid URL';
      }
    }

    function decodeURL(url) {
      try {
        return decodeURIComponent(url);
      } catch {
        return 'Invalid URL';
      }
    }

    document.getElementById('encode-url-btn').addEventListener('click', () => {
      const url = document.getElementById('url-input').value;
      if (!url.trim()) {
        alert('Please enter a URL to encode.');
        return;
      }
      const encoded = encodeURL(url);
      document.getElementById('url-result').innerText = encoded;
    });

    document.getElementById('decode-url-btn').addEventListener('click', () => {
      const url = document.getElementById('url-input').value;
      if (!url.trim()) {
        alert('Please enter a URL to decode.');
        return;
      }
      const decoded = decodeURL(url);
      document.getElementById('url-result').innerText = decoded;
    });

    function getLuminance(hex) {
      const rgb = hex.match(/\w\w/g).map(x => parseInt(x, 16) / 255);
      const a = rgb.map(v => {
        return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
    }

    function calculateContrast(hex1, hex2) {
      const lum1 = getLuminance(hex1);
      const lum2 = getLuminance(hex2);
      const brightest = Math.max(lum1, lum2);
      const darkest = Math.min(lum1, lum2);
      const contrast = (brightest + 0.05) / (darkest + 0.05);
      return contrast.toFixed(2);
    }

    document.getElementById('check-contrast-btn').addEventListener('click', () => {
      const color1 = document.getElementById('color1').value;
      const color2 = document.getElementById('color2').value;
      const contrastRatio = calculateContrast(color1, color2);
      
      let compliance = '';
      if (contrastRatio >= 7) {
        compliance = 'AAA';
      } else if (contrastRatio >= 4.5) {
        compliance = 'AA';
      } else {
        compliance = 'Fail';
      }
      
      let colorScheme = 'Good contrast';
      let color = '#27ae60'; 
      if (compliance === 'AA') {
        colorScheme = 'Acceptable contrast';
        color = '#f39c12';
      } else if (compliance === 'Fail') {
        colorScheme = 'Poor contrast';
        color = '#c0392b';
      }
      
      document.getElementById('contrast-result').innerHTML = `
        <strong>Contrast Ratio:</strong> ${contrastRatio}:1<br>
        <strong>WCAG Compliance:</strong> ${compliance} (${colorScheme})
      `;
      document.getElementById('contrast-result').style.color = color;
    });

    let currentInput = '';
    let operator = '';
    let previousInput = '';

    const display = document.getElementById('calculator-display');

    document.querySelectorAll('.calc-btn').forEach(button => {
      button.addEventListener('click', () => {
        const value = button.getAttribute('data-value');
        
        if (!value) return;
        
        if (!isNaN(value) || value === '.') {
          currentInput += value;
          display.value = currentInput;
        } else if (['+', '-', '*', '/'].includes(value)) {
          if (currentInput === '') return;
          operator = value;
          previousInput = currentInput;
          currentInput = '';
        }
      });
    });

    document.getElementById('clear-btn').addEventListener('click', () => {
      currentInput = '';
      operator = '';
      previousInput = '';
      display.value = '';
    });

    document.getElementById('equals-btn').addEventListener('click', () => {
      if (operator === '' || currentInput === '' || previousInput === '') return;
      
      const num1 = parseFloat(previousInput);
      const num2 = parseFloat(currentInput);
      let result;
      
      switch(operator) {
        case '+':
          result = num1 + num2;
          break;
        case '-':
          result = num1 - num2;
          break;
        case '*':
          result = num1 * num2;
          break;
        case '/':
          if (num2 === 0) {
            alert('Cannot divide by zero.');
            return;
          }
          result = num1 / num2;
          break;
        default:
          return;
      }
      
      display.value = result;
      currentInput = result.toString();
      operator = '';
      previousInput = '';
    });

    document.getElementById('generate-qr-btn').addEventListener('click', () => {
      const qrText = document.getElementById('qr-text-input').value.trim();
      const qrCodeDiv = document.getElementById('qr-code');
      
      if (!qrText) {
        alert('Please enter text or a URL to generate QR Code.');
        return;
      }
      
      qrCodeDiv.innerHTML = '';
      new QRCode(qrCodeDiv, {
        text: qrText,
        width: 128,
        height: 128,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
      });
    });

    document.getElementById('add-todo-btn').addEventListener('click', () => {
      const taskInput = document.getElementById('todo-input');
      const taskText = taskInput.value.trim();
      
      if (!taskText) {
        alert('Please enter a task.');
        return;
      }
      
      const todoList = document.getElementById('todo-list');
      
      const li = document.createElement('li');
      li.style.display = 'flex';
      li.style.alignItems = 'center';
      li.style.marginBottom = '8px';
      li.style.fontSize = '0.95rem';
      li.style.color = 'var(--text-color)';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.style.marginRight = '10px';
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          li.style.textDecoration = 'line-through';
          li.style.color = '#6c757d';
        } else {
          li.style.textDecoration = 'none';
          li.style.color = 'var(--text-color)';
        }
      });
      
      const taskSpan = document.createElement('span');
      taskSpan.innerText = taskText;
      taskSpan.style.flexGrow = '1';
      
      const deleteBtn = document.createElement('button');
      deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
      deleteBtn.style.background = 'none';
      deleteBtn.style.border = 'none';
      deleteBtn.style.color = '#c0392b';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.addEventListener('click', () => {
        todoList.removeChild(li);
      });
      
      li.appendChild(checkbox);
      li.appendChild(taskSpan);
      li.appendChild(deleteBtn);
      
      todoList.appendChild(li);
      
      taskInput.value = '';
    });

    function initializeDashboard() {
      updateSystemInfo();
      updateInternetConnectivity();
      updateBatteryStatus();
      updateScreenResolution();
      updateLocation();
      updateTimeZone();
      updateMemoryUsage();
      updateSensorsAvailability();
      updateMediaDevices();
      checkWebGLSupport();
      detectAdBlocker();
      checkServiceWorkerStatus();
      getWebRTCIpAddresses();
      updateJsErrors();
      updatePublicIP();
      updateVisitorCount();

      setInterval(updateInternetConnectivity, 5000);
      setInterval(updateBatteryStatus, 60000);
      setInterval(updateSystemInfo, 60000);
    }

    window.addEventListener('resize', updateScreenResolution);
    window.addEventListener('load', () => {
      initializeDashboard();

      document.getElementById('search-button').addEventListener('click', performWebSearch);
      document.getElementById('start-ping-test-btn').addEventListener('click', startPingTest);
      document.getElementById('refresh-ip-btn').addEventListener('click', updatePublicIP);
      document.getElementById('dns-lookup-btn').addEventListener('click', performDNSLookup);
      document.getElementById('start-js-error-analysis-btn').addEventListener('click', startJsErrorAnalysis);
      document.getElementById('toggle-webcam-btn').addEventListener('click', toggleWebcam);
      document.getElementById('toggle-microphone-btn').addEventListener('click', toggleMicrophone);
      document.getElementById('run-compatibility-check').addEventListener('click', runCompatibilityCheck);

      const copySystemInfoBtn = document.getElementById('copy-system-info-btn');
      const clearCookiesBtn = document.getElementById('clear-cookies-btn');
      const resetAppDataBtn = document.getElementById('reset-app-data-btn');
      const reloadPageBtn = document.getElementById('reload-page-btn');
      const retestConnectivityBtn = document.getElementById('retest-connectivity-btn');
      const retestLocationBtn = document.getElementById('retest-location-btn');
      const retestMediaDevicesBtn = document.getElementById('retest-media-devices-btn');
      const retestWebrtcBtn = document.getElementById('retest-webrtc-btn');

      if (copySystemInfoBtn) copySystemInfoBtn.addEventListener('click', copySystemInfo);
      if (clearCookiesBtn) clearCookiesBtn.addEventListener('click', clearCookies);
      if (resetAppDataBtn) resetAppDataBtn.addEventListener('click', resetAppData);
      if (reloadPageBtn) reloadPageBtn.addEventListener('click', reloadPage);
      if (retestConnectivityBtn) retestConnectivityBtn.addEventListener('click', updateInternetConnectivity);
      if (retestLocationBtn) retestLocationBtn.addEventListener('click', updateLocation);
      if (retestMediaDevicesBtn) retestMediaDevicesBtn.addEventListener('click', updateMediaDevices);
      if (retestWebrtcBtn) retestWebrtcBtn.addEventListener('click', getWebRTCIpAddresses);
    });
</script>
</body>
</html>
