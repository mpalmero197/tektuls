<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TekTuls - Comprehensive Troubleshooting Dashboard</title>
  <!-- Include Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include FontAwesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Include Leaflet.js for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Include QRCode.js for QR Code Generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Include Roboto Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
  <style>
    :root {
      --primary-color: #0d6efd; /* Deep Blue */
      --secondary-color: #121212; /* Very Dark Gray */
      --accent-color: #20c997; /* Cyan */
      --success-color: #198754; /* Green */
      --danger-color: #dc3545; /* Red */
      --warning-color: #ffc107; /* Yellow */
      --info-color: #0dcaf0; /* Light Blue */
      --light-bg: #1e1e1e; /* Darker Gray */
      --card-bg: #2a2a2a; /* Slightly Lighter Gray */
      --text-color: #ffffff; /* Pure White */
      --muted-text: #b0b0b0; /* Medium Gray */
      --border-radius: 6px;
      --transition-speed: 0.3s;
      --font-family: 'Roboto', sans-serif;
      --input-bg: #1e1e1e;
      --input-border: none;
      --input-focus-bg: #2a2a2a;
      --button-hover-bg: #0b5ed7;
      --button-active-bg: #0a58ca;
      --sidebar-width: 250px;
      --scrollbar-width: 8px;
      --scrollbar-thumb-bg: #555; /* Medium Gray */
      --scrollbar-thumb-hover-bg: #777; /* Lighter Gray on hover */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-family);
      background-color: var(--secondary-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow: hidden; /* Prevent body from scrolling */
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: var(--scrollbar-width);
    }

    ::-webkit-scrollbar-track {
      background: transparent; /* No background */
    }

    ::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb-bg);
      border-radius: var(--border-radius);
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover-bg);
    }

    /* Firefox */
    body, .sidebar, .content {
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb-bg) transparent;
    }

    /* Top Bar */
    .top-bar {
      width: 100%;
      background-color: var(--secondary-color);
      padding: 15px 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      border-bottom: 1px solid #333;
      z-index: 1000;
    }

    .top-bar .left-section {
      display: flex;
      align-items: center;
    }

    /* Hamburger Menu Button */
    .hamburger {
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color var(--transition-speed);
      margin-right: 15px;
    }

    .hamburger:hover {
      color: var(--accent-color);
    }

    .top-bar .title {
      font-size: 1.8rem;
      font-weight: 500;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }

    .top-bar .title i {
      margin-right: 10px;
    }

    .top-bar .search-container {
      display: flex;
      align-items: center;
      max-width: 700px;
      width: 100%;
      margin-left: 20px;
    }

    .top-bar select {
      padding: 10px 15px;
      border: var(--input-border);
      border-radius: 4px 0 0 4px;
      outline: none;
      background-color: var(--input-bg);
      color: var(--muted-text);
      font-size: 1rem;
      cursor: pointer;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    .top-bar select:hover, .top-bar select:focus {
      background-color: var(--input-focus-bg);
      color: var(--text-color);
    }

    .top-bar input[type="text"] {
      flex-grow: 1;
      padding: 10px 15px;
      margin: 0;
      border: var(--input-border);
      outline: none;
      background-color: var(--input-bg);
      color: var(--text-color);
      font-size: 1rem;
      border-radius: 0;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    .top-bar input[type="text"]::placeholder {
      color: var(--muted-text);
    }

    .top-bar input[type="text"]:focus {
      background-color: var(--input-focus-bg);
    }

    .top-bar button {
      padding: 10px 20px;
      border: none;
      outline: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--primary-color);
      color: #ffffff;
      transition: background-color var(--transition-speed), transform var(--transition-speed);
    }

    .top-bar button:hover {
      background-color: var(--button-hover-bg);
    }

    .top-bar button:active {
      background-color: var(--button-active-bg);
      transform: translateY(0);
    }

    .top-bar button i {
      margin-right: 8px;
    }

    /* Main Container */
    .main-container {
      display: flex;
      flex-grow: 1;
      background-color: var(--light-bg);
      overflow: hidden; /* Prevent main container from scrolling */
      position: relative;
      transition: margin-left var(--transition-speed);
    }

    /* Sidebar Styling */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--secondary-color);
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #333;
      transition: transform var(--transition-speed), margin-left var(--transition-speed), width var(--transition-speed);
      position: fixed;
      top: 64px; /* Height of top-bar */
      left: 0;
      height: calc(100vh - 64px - 60px); /* Adjust based on top-bar and footer heights */
      z-index: 999;
      transform: translateX(-100%); /* Hidden by default */
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .main-container.shifted {
      margin-left: var(--sidebar-width);
    }

    .sidebar-content {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }

    .sidebar h2 {
      margin-bottom: 20px;
      font-size: 1.4rem;
      color: var(--text-color);
      display: flex;
      align-items: center;
      transition: opacity var(--transition-speed), visibility var(--transition-speed);
    }

    .sidebar h2 i {
      margin-right: 10px;
      font-size: 1.4rem;
    }

    .sidebar button {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 10px;
      background-color: #1c1c1c; /* Slightly lighter dark gray */
      color: var(--text-color);
      border: none;
      border-radius: var(--border-radius);
      font-size: 0.95rem;
      text-align: left;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background-color var(--transition-speed), color var(--transition-speed);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar button:hover {
      background-color: #2c2c2c; /* Even lighter gray on hover */
    }

    .sidebar button i {
      margin-right: 10px;
      font-size: 1.1rem;
      min-width: 20px;
      text-align: center;
    }

    /* Content Area */
    .content {
      flex-grow: 1;
      padding: 30px;
      box-sizing: border-box;
      overflow-y: auto;
      position: relative;
      height: calc(100vh - 64px - 60px); /* Adjust based on top-bar and footer heights */
      margin-left: 0; /* No margin when sidebar is hidden */
      transition: margin-left var(--transition-speed);
    }

    /* Overlay when sidebar is active */
    .overlay {
      position: fixed;
      top: 64px; /* Height of top-bar */
      left: 0;
      width: 100%;
      height: calc(100vh - 64px - 60px); /* Adjust based on top-bar and footer heights */
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 998;
    }

    .overlay.active {
      display: block;
    }

    .hero {
      text-align: center;
      margin-bottom: 50px;
    }

    .hero__title {
      font-size: 2.5rem;
      font-weight: 500;
      margin-bottom: 15px;
      color: var(--text-color);
      position: relative;
    }

    .hero__title::after {
      content: "";
      position: absolute;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle at center, rgba(13, 110, 253,0.2) 0%, transparent 70%);
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0.3;
      pointer-events: none;
      border-radius: 50%;
    }

    .hero__subtitle {
      font-size: 1.1rem;
      color: var(--muted-text);
      max-width: 700px;
      margin: 0 auto;
    }

    .category-section {
      margin-bottom: 50px;
    }

    .category-section h2 {
      font-size: 1.8rem;
      margin-bottom: 25px;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }

    .category-section h2 i {
      margin-right: 10px;
      font-size: 1.6rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }

    .card {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      position: relative;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    }

    .card::before {
      content: "";
      position: absolute;
      top: -8px;
      right: -8px;
      width: 20px;
      height: 20px;
      background-color: var(--primary-color);
      border-radius: 50%;
      opacity: 0.2;
      pointer-events: none;
    }

    .card h2 {
      margin-bottom: 20px;
      font-size: 1.3rem;
      color: var(--text-color);
      display: flex;
      align-items: center;
    }

    .card h2 i {
      margin-right: 10px;
      font-size: 1.2rem;
    }

    .card-content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: #ffffff;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color var(--transition-speed), transform var(--transition-speed);
    }

    .btn-primary:hover {
      background-color: var(--button-hover-bg);
      transform: translateY(-2px);
    }

    .btn-primary:active {
      background-color: var(--button-active-bg);
      transform: translateY(0);
    }

    .btn-primary i {
      margin-right: 8px;
    }

    .input-field {
      width: 100%;
      padding: 10px 15px;
      margin-bottom: 15px;
      border: var(--input-border);
      outline: none;
      background-color: var(--input-bg);
      color: var(--text-color);
      font-size: 1rem;
      border-radius: var(--border-radius);
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }

    .input-field::placeholder {
      color: var(--muted-text);
    }

    .input-field:focus {
      background-color: var(--input-focus-bg);
    }

    .result, #dns-result, #js-error-analyzer-result, #accessibility-results, #compatibility-results, #snapshot-message, #url-result, #contrast-result, #text-analysis-result {
      margin-top: 15px;
      font-size: 0.95rem;
    }

    .progress-bar-container, #mic-level-container, #battery-progress-bar-container, #storage-progress-bar-container {
      width: 100%;
      background-color: #333;
      border-radius: var(--border-radius);
      overflow: hidden;
      height: 20px;
      margin-top: 10px;
    }

    .progress-bar, #mic-level, #battery-progress-bar, #storage-progress-bar {
      width: 0%;
      height: 100%;
      background-color: var(--primary-color);
      transition: width 0.3s, background-color 0.3s;
      border-radius: var(--border-radius);
    }

    #webcam-video {
      width: 100%;
      max-height: 150px;
      background-color: #000;
      border-radius: var(--border-radius);
      display: none;
      object-fit: cover;
      margin-top: 10px;
    }

    #mic-level {
      background-color: var(--accent-color);
    }

    #battery-progress-bar {
      background-color: var(--accent-color);
    }

    #storage-progress-bar {
      background-color: var(--primary-color);
    }

    #screen-rectangle {
      background-color: var(--accent-color);
      width: 100px;
      height: 100px;
      margin: 0 auto;
      border-radius: var(--border-radius);
    }

    .info-table {
      width: 100%;
      border-collapse: collapse;
    }

    .info-table th, .info-table td {
      text-align: left;
      padding: 8px 10px;
      border-bottom: 1px solid #444;
      font-size: 0.95rem;
    }

    .info-table th {
      width: 40%;
      color: var(--accent-color);
    }

    .info-table td {
      width: 60%;
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    ul li {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    ul li i {
      margin-right: 8px;
      font-size: 1.1rem;
    }

    .footer {
      background-color: var(--secondary-color);
      color: var(--muted-text);
      text-align: center;
      padding: 15px 30px;
      font-size: 0.9rem;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      flex-wrap: wrap;
      border-top: 1px solid #333;
      z-index: 1000;
    }

    .footer a {
      color: var(--accent-color);
      text-decoration: none;
      transition: color var(--transition-speed);
    }

    .footer a:hover {
      color: var(--primary-color);
    }

    .footer .visitor-count {
      display: flex;
      align-items: center;
    }

    .footer .visitor-count .label {
      font-weight: bold;
      margin-right: 5px;
      color: var(--accent-color);
    }

    @media (max-width: 1024px) {
      .sidebar {
        width: var(--sidebar-width);
      }

      .content {
        padding: 20px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 80%;
        padding: 15px;
        border-right: none;
        border-bottom: 1px solid #333;
        height: calc(100vh - 64px - 60px);
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .main-container.shifted {
        margin-left: 80%;
      }

      .overlay.active {
        display: block;
      }

      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .hero__title {
        font-size: 2rem;
      }

      .hero__subtitle {
        font-size: 1rem;
      }

      .footer {
        flex-direction: column;
        gap: 15px;
      }

      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }

      .top-bar .search-container {
        width: 100%;
        margin-left: 0;
        margin-top: 15px;
      }

      .top-bar button {
        width: 100%;
        border-radius: 4px;
        margin-top: 10px;
      }

      .sidebar button {
        font-size: 1rem;
        padding: 10px 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="left-section">
      <!-- Hamburger Menu Button -->
      <button class="hamburger" id="hamburger-btn" aria-label="Toggle Sidebar">
        <i class="fas fa-bars"></i>
      </button>
      <div class="title"><i class="fas fa-tools"></i> TekTuls</div>
    </div>
    <div class="search-container">
      <select id="search-engine">
        <option value="google">Google</option>
        <option value="duckduckgo">DuckDuckGo</option>
        <option value="yahoo">Yahoo</option>
      </select>
      <input type="text" id="search-query" class="input-field" placeholder="Search the web...">
      <button id="search-button" class="btn-primary"><i class="fas fa-search"></i> Search</button>
    </div>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-content">
        <h2><i class="fas fa-box-open"></i> Tool Box</h2>
        <button id="copy-system-info-btn"><i class="fas fa-copy"></i> Copy System Info</button>
        <button id="clear-local-storage-btn"><i class="fas fa-database"></i> Clear Local Storage</button>
        <button id="clear-session-storage-btn"><i class="fas fa-window-close"></i> Clear Session Storage</button>
        <button id="clear-cookies-btn"><i class="fas fa-cookie-bite"></i> Clear Cookies</button>
        <button id="reset-app-data-btn"><i class="fas fa-sync-alt"></i> Reset App Data</button>
        <button id="reload-page-btn"><i class="fas fa-redo"></i> Reload Page</button>
        <button id="retest-connectivity-btn"><i class="fas fa-globe"></i> Retest Connectivity</button>
        <button id="retest-location-btn"><i class="fas fa-map-marker-alt"></i> Retest Location</button>
        <button id="retest-media-devices-btn"><i class="fas fa-video"></i> Retest Media Devices</button>
        <button id="retest-webrtc-btn"><i class="fas fa-network-wired"></i> Retest WebRTC</button>
        <button id="clear-errors-btn"><i class="fas fa-exclamation-triangle"></i> Clear Errors</button>
        <button id="perform-ping-test-btn"><i class="fas fa-signal"></i> Perform Ping Test</button>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content" id="main-content">
      <!-- Hero Section -->
      <div class="hero">
        <h1 class="hero__title"><i class="fas fa-chart-bar"></i> Comprehensive Troubleshooting Dashboard</h1>
        <p class="hero__subtitle">A full suite of interactive troubleshooting tools at your fingertips.</p>
      </div>

      <!-- Network Tools -->
      <div class="category-section">
        <h2><i class="fas fa-network-wired"></i> Network Tools</h2>
        <div class="dashboard-grid">
          <!-- Ping Test Card -->
          <div class="card" id="ping-card">
            <h2><i class="fas fa-signal"></i> Ping Test</h2>
            <div class="card-content">
              <input type="text" id="ping-address" class="input-field" placeholder="Enter server address (e.g., example.com)">
              <button id="start-ping-test-btn" class="btn-primary"><i class="fas fa-play"></i> Start Ping Test</button>
              <canvas id="pingChart" style="margin-top: 20px; height: 150px;"></canvas>
            </div>
          </div>

          <!-- Internet Connectivity Card -->
          <div class="card" id="internet-card">
            <h2><i class="fas fa-globe"></i> Internet Connectivity</h2>
            <div class="card-content" style="text-align: center;">
              <i id="internet-status-icon" class="fas fa-circle" style="font-size: 48px; color: #198754;"></i>
              <p id="internet-status-text" style="margin-top: 10px; font-size: 1.1rem;">Online</p>
            </div>
          </div>

          <!-- Network Speed Card -->
          <div class="card network-speed-card">
            <h2><i class="fas fa-chart-line"></i> Network Speed</h2>
            <div class="card-content">
              <div class="network-speed-chart-container">
                <canvas id="networkSpeedChart"></canvas>
              </div>
              <p id="current-speed" style="text-align: center; margin-top: 15px; font-size: 1rem; color: #198754;">
                Current Speed: <strong>-- Mbps</strong>
              </p>
            </div>
          </div>

          <!-- Network Information Card -->
          <div class="card" id="network-info-card">
            <h2><i class="fas fa-network-wired"></i> Network Information</h2>
            <div class="card-content">
              <strong>Public IP Address:</strong>
              <p id="public-ip" style="margin-top: 5px; color: #198754;">Fetching...</p>
              <button id="refresh-ip-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-sync-alt"></i> Refresh IP</button>
              <div class="network-info" style="margin-top: 20px;">
                <strong>DNS Lookup:</strong>
                <input type="text" id="dns-domain" class="input-field" placeholder="Enter domain name (e.g., example.com)">
                <button id="dns-lookup-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-search"></i> Lookup DNS</button>
                <div class="result" id="dns-result"></div>
              </div>
            </div>
          </div>

          <!-- WebRTC IP Addresses Card -->
          <div class="card" id="webrtc-card">
            <h2><i class="fas fa-network-wired"></i> WebRTC IP Addresses</h2>
            <div class="card-content" id="webrtc-content" style="color: #0dcaf0;">
              Retrieving...
            </div>
          </div>
        </div>
      </div>

      <!-- System Information -->
      <div class="category-section">
        <h2><i class="fas fa-desktop"></i> System Information</h2>
        <div class="dashboard-grid">
          <!-- System Info Card -->
          <div class="card" id="system-info-card">
            <h2><i class="fas fa-desktop"></i> System Information</h2>
            <div class="card-content" id="system-info-content">
              <table class="info-table">
                <tbody>
                  <tr><th>Operating System:</th><td id="os-info">Loading...</td></tr>
                  <tr><th>Device Type:</th><td id="device-type-info">Loading...</td></tr>
                  <tr><th>RAM:</th><td id="ram-info">Loading...</td></tr>
                  <tr><th>Processor:</th><td id="processor-info">Loading...</td></tr>
                  <tr><th>Disk Space:</th><td id="disk-space-info">Loading...</td></tr>
                  <tr><th>Browser:</th><td id="browser-info">Loading...</td></tr>
                  <tr><th>Platform:</th><td id="platform-info">Loading...</td></tr>
                  <tr><th>Language:</th><td id="language-info">Loading...</td></tr>
                  <tr><th>Online:</th><td id="online-status-info">Loading...</td></tr>
                  <tr><th>Cookies Enabled:</th><td id="cookies-enabled-info">Loading...</td></tr>
                  <tr><th>Touch Support:</th><td id="touch-support-info">Loading...</td></tr>
                </tbody>
              </table>
              <p style="font-size: 0.85rem; margin-top: 10px; color: var(--muted-text);">
                <em>Note: Disk space usage reflects browser storage quota usage, not entire system disk usage.</em>
              </p>
            </div>
          </div>

          <!-- Memory Usage Chart -->
          <div class="card">
            <h2><i class="fas fa-memory"></i> Memory Usage</h2>
            <canvas id="memoryChart" style="margin-top: 20px; height: 150px;"></canvas>
          </div>

          <!-- Battery Status Card -->
          <div class="card" id="battery-card">
            <h2><i class="fas fa-battery-half"></i> Battery Status</h2>
            <div class="card-content">
              <div class="progress-bar-container">
                <div id="battery-progress-bar" class="progress-bar"></div>
              </div>
              <p id="battery-status-text" style="margin-top: 10px; font-size: 1rem; color: #0dcaf0;">Loading...</p>
            </div>
          </div>

          <!-- Screen Resolution Card -->
          <div class="card" id="screen-card">
            <h2><i class="fas fa-tv"></i> Screen Resolution</h2>
            <div class="card-content">
              <div id="screen-rectangle" style="background-color: var(--accent-color);"></div>
              <p id="screen-dimensions-text" style="text-align: center; margin-top: 10px; font-size: 1rem; color: #0dcaf0;"></p>
            </div>
          </div>

          <!-- Time Zone & Locale Card -->
          <div class="card" id="timezone-card">
            <h2><i class="fas fa-clock"></i> Time Zone & Locale</h2>
            <div class="card-content">
              <table class="info-table">
                <tbody>
                  <tr><th>Time Zone:</th><td id="timezone-info">Loading...</td></tr>
                  <tr><th>Locale:</th><td id="locale-info">Loading...</td></tr>
                </tbody>
              </table>
              <!-- Map -->
              <div id="map" style="height: 200px; margin-top: 15px; border-radius: var(--border-radius);"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Device Sensors and Media -->
      <div class="category-section">
        <h2><i class="fas fa-cogs"></i> Device Sensors and Media</h2>
        <div class="dashboard-grid">
          <!-- Sensors Availability Card -->
          <div class="card" id="sensors-card">
            <h2><i class="fas fa-cogs"></i> Sensors Availability</h2>
            <div class="card-content" id="sensors-content" style="color: #0dcaf0;">
              <!-- Populated by JS -->
            </div>
          </div>

          <!-- Media Devices Card -->
          <div class="card" id="media-card">
            <h2><i class="fas fa-video"></i> Media Devices</h2>
            <div class="card-content" id="media-content">
              <strong>Available Media Devices:</strong>
              <ul id="media-devices-list" style="margin-top: 10px;">
                <!-- Populated by JS -->
              </ul>
              <!-- Webcam Test -->
              <div class="media-test" style="margin-top: 20px;">
                <button id="toggle-webcam-btn" class="btn-primary"><i class="fas fa-camera"></i> Test Webcam</button>
                <video id="webcam-video" autoplay playsinline></video>
              </div>
              <!-- Microphone Test -->
              <div class="media-test" style="margin-top: 20px;">
                <button id="toggle-microphone-btn" class="btn-primary"><i class="fas fa-microphone"></i> Test Microphone</button>
                <div id="mic-level-container">
                  <div id="mic-level"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Security and Privacy -->
      <div class="category-section">
        <h2><i class="fas fa-shield-alt"></i> Security and Privacy</h2>
        <div class="dashboard-grid">
          <!-- Ad Blocker Detection Card -->
          <div class="card" id="adblocker-card">
            <h2><i class="fas fa-ban"></i> Ad Blocker Detection</h2>
            <div class="card-content" id="adblocker-content" style="text-align: center; color: #0dcaf0;">
              Detecting...
            </div>
          </div>

          <!-- Service Worker Status Card -->
          <div class="card" id="serviceworker-card">
            <h2><i class="fas fa-robot"></i> Service Worker Status</h2>
            <div class="card-content" id="serviceworker-content" style="text-align: center; color: #0dcaf0;">
              Checking...
            </div>
          </div>

          <!-- JavaScript Errors Card -->
          <div class="card" id="js-errors-card">
            <h2><i class="fas fa-exclamation-triangle"></i> JavaScript Errors</h2>
            <div class="card-content" id="js-errors-content" style="color: #dc3545;">
              No errors detected.
            </div>
          </div>

          <!-- JavaScript Error Analyzer Card -->
          <div class="card" id="js-error-analyzer-card">
            <h2><i class="fas fa-code"></i> JavaScript Error Analyzer</h2>
            <div class="card-content">
              <input type="text" id="analyzer-url" class="input-field" placeholder="Enter website URL (e.g., http://localhost:8000/testPage.html)">
              <button id="start-js-error-analysis-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-search"></i> Analyze JavaScript Errors</button>
              <div id="js-error-analyzer-result" style="margin-top: 15px;"></div>
              <iframe id="js-error-analyzer-iframe" src="" style="width: 100%; height: 0; border: none; display: none;"></iframe>
            </div>
          </div>
        </div>
      </div>

      <!-- Storage Management -->
      <div class="category-section">
        <h2><i class="fas fa-database"></i> Storage Management</h2>
        <div class="dashboard-grid">
          <!-- Storage Usage Card -->
          <div class="card">
            <h2><i class="fas fa-database"></i> Storage Usage</h2>
            <div class="card-content" id="storage-usage-content">
              <div class="progress-bar-container">
                <div id="storage-progress-bar" class="progress-bar"></div>
              </div>
              <p id="storage-usage-text" style="margin-top: 10px; font-size: 1rem; color: #0dcaf0;">
                Calculating storage usage...
              </p>
              <p style="font-size: 0.85rem; margin-top: 10px; color: var(--muted-text);">
                This shows the storage used by this web application within your browser, not the entire system's disk usage.
              </p>
            </div>
          </div>

          <!-- Local Storage Viewer Card -->
          <div class="card">
            <h2><i class="fas fa-eye"></i> Local Storage Viewer</h2>
            <div class="card-content">
              <button id="refresh-storage-btn" class="btn-primary" style="margin-bottom: 15px;"><i class="fas fa-sync-alt"></i> Refresh</button>
              <table class="info-table">
                <thead>
                  <tr>
                    <th>Key</th>
                    <th>Value</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="local-storage-table-body">
                  <!-- Entries will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Monitoring -->
      <div class="category-section">
        <h2><i class="fas fa-tachometer-alt"></i> Performance Monitoring</h2>
        <div class="dashboard-grid">
          <!-- FPS Monitor Card -->
          <div class="card">
            <h2><i class="fas fa-tachometer-alt"></i> FPS Monitor</h2>
            <canvas id="performanceChart" style="margin-top: 20px; height: 150px;"></canvas>
          </div>

          <!-- WebGL Support Card -->
          <div class="card" id="webgl-card">
            <h2><i class="fas fa-cube"></i> WebGL Support</h2>
            <div class="card-content" id="webgl-content" style="text-align: center; color: #0dcaf0;">
              Checking...
            </div>
          </div>
        </div>
      </div>

      <!-- Accessibility & Compatibility -->
      <div class="category-section">
        <h2><i class="fas fa-universal-access"></i> Accessibility & Compatibility</h2>
        <div class="dashboard-grid">
          <!-- Accessibility Checker Card -->
          <div class="card" id="accessibility-card">
            <h2><i class="fas fa-universal-access"></i> Accessibility Checker</h2>
            <div class="card-content" id="accessibility-content">
              <p style="font-size: 0.95rem; color: var(--muted-text);">
                Enter a website URL to check for basic accessibility issues (missing alt attributes, unlabeled form fields). Note that cross-origin restrictions may apply.
              </p>
              <input type="text" id="accessibility-url" class="input-field" placeholder="Enter website URL (e.g., http://example.com)">
              <button id="check-website-accessibility" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-check"></i> Check Website Accessibility</button>
              <div id="accessibility-results" style="margin-top: 15px;"></div>
              <iframe id="accessibility-iframe" src="" style="width: 100%; height: 0; border: none; display: none;"></iframe>
            </div>
          </div>

          <!-- Browser Compatibility Checker Card -->
          <div class="card" id="compatibility-card">
            <h2><i class="fas fa-browser"></i> Browser Compatibility Checker</h2>
            <div class="card-content" id="compatibility-content">
              <p style="font-size: 0.95rem; color: var(--muted-text);">
                Check if your browser supports key modern web features.
              </p>
              <button id="run-compatibility-check" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-check"></i> Run Compatibility Check</button>
              <div id="compatibility-results" style="margin-top: 15px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Website Tools -->
      <div class="category-section">
        <h2><i class="fas fa-globe"></i> Website Tools</h2>
        <div class="dashboard-grid">
          <!-- Website Snapshot Card -->
          <div class="card website-snapshot-card">
            <h2><i class="fas fa-camera"></i> Website Snapshot</h2>
            <div class="card-content">
              <input type="text" id="snapshot-url" class="input-field" placeholder="Enter website URL (e.g., https://example.com)">
              <button id="snapshot-button" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-camera"></i> Capture Snapshot</button>
              <img id="website-snapshot-image" src="" alt="Website Snapshot" style="margin-top: 20px; border: 2px solid #b0b0b0; border-radius: var(--border-radius); display: none;">
              <div id="snapshot-message" style="margin-top: 15px; font-size: 0.95rem; color: var(--muted-text);"></div>
            </div>
          </div>

          <!-- QR Code Generator Card -->
          <div class="card" id="qr-code-card">
            <h2><i class="fas fa-qrcode"></i> QR Code Generator</h2>
            <div class="card-content">
              <input type="text" id="qr-text-input" class="input-field" placeholder="Enter text or URL...">
              <button id="generate-qr-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-qrcode"></i> Generate QR Code</button>
              <div id="qr-code" style="margin-top: 15px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Utilities -->
      <div class="category-section">
        <h2><i class="fas fa-tools"></i> Utilities</h2>
        <div class="dashboard-grid">
          <!-- Password Generator Card -->
          <div class="card" id="password-generator-card">
            <h2><i class="fas fa-key"></i> Password Generator</h2>
            <div class="card-content">
              <label for="password-length">Length:</label>
              <input type="number" id="password-length" class="input-field" min="4" max="64" value="12">

              <div style="margin-top: 10px;">
                <input type="checkbox" id="include-uppercase" checked>
                <label for="include-uppercase">Include Uppercase Letters</label>
              </div>

              <div>
                <input type="checkbox" id="include-numbers" checked>
                <label for="include-numbers">Include Numbers</label>
              </div>

              <div>
                <input type="checkbox" id="include-special" checked>
                <label for="include-special">Include Special Characters</label>
              </div>

              <button id="generate-password-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-random"></i> Generate Password</button>

              <div id="generated-password" style="margin-top: 15px; word-wrap: break-word; font-size: 1rem; color: var(--accent-color);"></div>
            </div>
          </div>

          <!-- Unit Converter Card -->
          <div class="card" id="unit-converter-card">
            <h2><i class="fas fa-exchange-alt"></i> Unit Converter</h2>
            <div class="card-content">
              <label for="conversion-category">Category:</label>
              <select id="conversion-category" class="input-field">
                <option value="length">Length</option>
                <option value="weight">Weight</option>
                <option value="temperature">Temperature</option>
                <option value="volume">Volume</option>
              </select>

              <label for="from-unit">From:</label>
              <select id="from-unit" class="input-field"></select>

              <label for="to-unit">To:</label>
              <select id="to-unit" class="input-field"></select>

              <label for="input-value">Value:</label>
              <input type="number" id="input-value" class="input-field" placeholder="Enter value">

              <button id="convert-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-sync-alt"></i> Convert</button>

              <div id="conversion-result" style="margin-top: 15px;"></div>
            </div>
          </div>

          <!-- Text Analyzer Card -->
          <div class="card" id="text-analyzer-card">
            <h2><i class="fas fa-align-left"></i> Text Analyzer</h2>
            <div class="card-content">
              <textarea id="text-input" class="input-field" rows="6" placeholder="Enter or paste your text here..."></textarea>
              <button id="analyze-text-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-chart-bar"></i> Analyze Text</button>
              <div id="text-analysis-result" style="margin-top: 15px;">
                <!-- Results will be displayed here -->
              </div>
            </div>
          </div>

          <!-- URL Encoder/Decoder Card -->
          <div class="card" id="url-encoder-decoder-card">
            <h2><i class="fas fa-link"></i> URL Encoder/Decoder</h2>
            <div class="card-content">
              <textarea id="url-input" class="input-field" rows="3" placeholder="Enter your URL here..."></textarea>

              <div style="margin-top: 10px;">
                <button id="encode-url-btn" class="btn-primary"><i class="fas fa-code"></i> Encode</button>
                <button id="decode-url-btn" class="btn-primary" style="margin-left: 10px;"><i class="fas fa-code-branch"></i> Decode</button>
              </div>

              <div id="url-result" style="margin-top: 15px; word-wrap: break-word; font-size: 1rem; color: var(--accent-color);"></div>
            </div>
          </div>

          <!-- Color Picker & Contrast Checker Card -->
          <div class="card" id="color-picker-card">
            <h2><i class="fas fa-palette"></i> Color Picker & Contrast Checker</h2>
            <div class="card-content">
              <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div>
                  <label for="color1">Color 1:</label>
                  <input type="color" id="color1" value="#ffffff" class="input-field" style="width: 100px; height: 50px; padding: 0; border: none;">
                </div>
                <div>
                  <label for="color2">Color 2:</label>
                  <input type="color" id="color2" value="#000000" class="input-field" style="width: 100px; height: 50px; padding: 0; border: none;">
                </div>
              </div>

              <button id="check-contrast-btn" class="btn-primary" style="margin-top: 15px;"><i class="fas fa-eye"></i> Check Contrast</button>

              <div id="contrast-result" style="margin-top: 15px; font-size: 1rem;"></div>

              <div style="margin-top: 20px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div style="width: 50px; height: 50px; background-color: #ffffff; border: 1px solid #ccc;"></div>
                  <div style="width: 50px; height: 50px; background-color: #000000; border: 1px solid #ccc;"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Calculator Card -->
          <div class="card" id="calculator-card">
            <h2><i class="fas fa-calculator"></i> Calculator</h2>
            <div class="card-content">
              <input type="text" id="calculator-display" class="input-field" placeholder="0" readonly style="text-align: right; font-size: 1.2rem;">
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px;">
                <button class="btn-primary calc-btn" data-value="7">7</button>
                <button class="btn-primary calc-btn" data-value="8">8</button>
                <button class="btn-primary calc-btn" data-value="9">9</button>
                <button class="btn-primary calc-btn" data-value="/">/</button>

                <button class="btn-primary calc-btn" data-value="4">4</button>
                <button class="btn-primary calc-btn" data-value="5">5</button>
                <button class="btn-primary calc-btn" data-value="6">6</button>
                <button class="btn-primary calc-btn" data-value="*">*</button>

                <button class="btn-primary calc-btn" data-value="1">1</button>
                <button class="btn-primary calc-btn" data-value="2">2</button>
                <button class="btn-primary calc-btn" data-value="3">3</button>
                <button class="btn-primary calc-btn" data-value="-">-</button>

                <button class="btn-primary calc-btn" data-value="0">0</button>
                <button class="btn-primary calc-btn" data-value=".">.</button>
                <button class="btn-primary calc-btn" id="clear-btn">C</button>
                <button class="btn-primary calc-btn" data-value="+">+</button>

                <button class="btn-primary calc-btn" style="grid-column: span 4; background-color: var(--success-color);" id="equals-btn">=</button>
              </div>
            </div>
          </div>

          <!-- To-Do List Card -->
          <div class="card" id="todo-list-card">
            <h2><i class="fas fa-tasks"></i> To-Do List</h2>
            <div class="card-content">
              <input type="text" id="todo-input" class="input-field" placeholder="Add a new task...">
              <button id="add-todo-btn" class="btn-primary" style="margin-top: 10px;"><i class="fas fa-plus"></i> Add Task</button>
              <ul id="todo-list" style="margin-top: 15px;">
                <!-- Tasks will be added here -->
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <span>© 2024 Michael Palmero</span>
    <a href="https://buymeacoffee.com/mpalmero" target="_blank"><i class="fas fa-coffee"></i> Buy me a coffee?</a>
    <div class="visitor-count">
      <span class="label">Visitors:</span> <span id="visitor-count">0</span>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    let errorLogs = [];

    window.onerror = function(message, source, lineno, colno, error) {
      const errorMessage = `${message} at ${source}:${lineno}:${colno}`;
      errorLogs.push(errorMessage);
      updateJsErrors();
      return false;
    };

    function updateVisitorCount() {
      const visitorCountElement = document.getElementById('visitor-count');
      let count = localStorage.getItem('visitorCount');
      if (count === null) {
        count = 1;
      } else {
        count = parseInt(count) + 1;
      }
      localStorage.setItem('visitorCount', count);
      visitorCountElement.innerText = count;
    }

    function copySystemInfo() {
      const systemInfoContentElement = document.getElementById('system-info-content');
      if (!systemInfoContentElement) {
        alert('System information content not found.');
        return;
      }
      const systemInfoContent = systemInfoContentElement.innerText;
      navigator.clipboard.writeText(systemInfoContent).then(() => {
        alert('System information copied to clipboard.');
      }, () => {
        alert('Failed to copy system information.');
      });
    }

    function clearLocalStorage() {
      localStorage.clear();
      alert('Local storage cleared.');
      localStorage.setItem('visitorCount', 0);
      document.getElementById('visitor-count').innerText = 0;
      populateLocalStorageTable();
    }

    function clearSessionStorage() {
      sessionStorage.clear();
      alert('Session storage cleared.');
    }

    function clearCookies() {
      document.cookie.split(";").forEach(function(c) {
        document.cookie = c.trim().startsWith("=") ? c : c.replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
      });
      alert('Cookies cleared.');
    }

    function resetAppData() {
      let count = localStorage.getItem('visitorCount');
      const keys = Object.keys(localStorage);
      for (let i=0; i<keys.length; i++) {
        if (keys[i] !== 'visitorCount') {
          localStorage.removeItem(keys[i]);
        }
      }
      if (count !== null) {
        localStorage.setItem('visitorCount', count);
        document.getElementById('visitor-count').innerText = count;
      }
      clearSessionStorage();
      clearCookies();
      alert('Application data reset. Reloading page...');
      reloadPage();
    }

    function reloadPage() {
      location.reload();
    }

    function clearErrors() {
      errorLogs = [];
      updateJsErrors();
      alert('Error logs cleared.');
    }

    function updateJsErrors() {
      const jsErrorsContent = document.getElementById('js-errors-content');
      if (jsErrorsContent) {
        if (errorLogs.length > 0) {
          jsErrorsContent.innerHTML = `<strong>Errors Detected (${errorLogs.length}):</strong><br>${errorLogs.join('<br>')}`;
        } else {
          jsErrorsContent.innerHTML = 'No errors detected.';
        }
      }
    }

    function getOS(userAgent) {
      if (userAgent.indexOf("Win") !== -1) return "Windows";
      if (userAgent.indexOf("Mac") !== -1) return "macOS";
      if (userAgent.indexOf("X11") !== -1) return "UNIX";
      if (userAgent.indexOf("Linux") !== -1) return "Linux";
      return "Unknown";
    }

    function getDeviceType() {
      const ua = navigator.userAgent;
      if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
        return "Mobile";
      }
      return "Desktop";
    }

    function updateSystemInfo() {
      const osInfo = document.getElementById('os-info');
      const deviceTypeInfo = document.getElementById('device-type-info');
      const ramInfo = document.getElementById('ram-info');
      const processorInfo = document.getElementById('processor-info');
      const diskSpaceInfo = document.getElementById('disk-space-info');
      const browserInfo = document.getElementById('browser-info');
      const platformInfo = document.getElementById('platform-info');
      const languageInfo = document.getElementById('language-info');
      const onlineStatusInfo = document.getElementById('online-status-info');
      const cookiesEnabledInfo = document.getElementById('cookies-enabled-info');
      const touchSupportInfo = document.getElementById('touch-support-info');

      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const language = navigator.language;
      const onlineStatus = navigator.onLine ? "Yes" : "No";
      const cookiesEnabled = navigator.cookieEnabled ? "Yes" : "No";
      const touchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0 ? "Yes" : "No";
      const os = getOS(userAgent);
      const ram = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Not Available";
      const processor = navigator.hardwareConcurrency ? `${navigator.hardwareConcurrency} Logical Processor(s)` : "Not Available";
      const deviceType = getDeviceType();

      osInfo.innerText = os;
      deviceTypeInfo.innerText = deviceType;
      ramInfo.innerText = ram;
      processorInfo.innerText = processor;
      browserInfo.innerText = userAgent;
      platformInfo.innerText = platform;
      languageInfo.innerText = language;
      onlineStatusInfo.innerText = onlineStatus;
      cookiesEnabledInfo.innerText = cookiesEnabled;
      touchSupportInfo.innerText = touchSupport;

      if (navigator.storage && navigator.storage.estimate) {
        navigator.storage.estimate().then(estimate => {
          const used = estimate.usage || 0;
          const quota = estimate.quota || 1;
          const usedPercentage = ((used / quota) * 100).toFixed(2);
          const usedMB = (used / (1024 * 1024)).toFixed(2);
          const quotaMB = (quota / (1024 * 1024)).toFixed(2);
          diskSpaceInfo.innerText = `Used: ${usedMB} MB / Total: ${quotaMB} MB (${usedPercentage}%)`;
        }).catch(() => {
          diskSpaceInfo.innerText = 'Not Available';
        });
      } else {
        diskSpaceInfo.innerText = 'Not Available';
      }
    }

    function updateInternetConnectivity() {
      const internetStatusIcon = document.getElementById('internet-status-icon');
      const internetStatusText = document.getElementById('internet-status-text');
      fetch('https://www.google.com/', { mode: 'no-cors' })
        .then(() => {
          internetStatusIcon.style.color = '#198754'; /* Green */
          internetStatusText.innerHTML = 'Online';
        })
        .catch(() => {
          internetStatusIcon.style.color = '#dc3545'; /* Red */
          internetStatusText.innerHTML = 'Offline';
        });
    }

    let fpsData = [];
    let fpsTimestamps = [];

    function updateFPSChart() {
      const now = performance.now();
      while (fpsTimestamps.length > 0 && fpsTimestamps[0] <= now - 1000) {
        fpsTimestamps.shift();
      }
      fpsTimestamps.push(now);
      const fps = fpsTimestamps.length;
      fpsData.push(fps);
      if (fpsData.length > 30) {
        fpsData.shift();
      }

      const maxFPS = Math.max(...fpsData);
      const nextHundred = Math.ceil(maxFPS / 100) * 100 || 100;
      fpsChart.options.scales.y.max = nextHundred;

      fpsChart.data.datasets[0].data = fpsData;
      fpsChart.update();
    }

    function trackFPS() {
      requestAnimationFrame(() => {
        updateFPSChart();
        trackFPS();
      });
    }

    const fpsCtx = document.getElementById('performanceChart').getContext('2d');
    const fpsChart = new Chart(fpsCtx, {
      type: 'line',
      data: {
        labels: Array(30).fill(''),
        datasets: [{
          label: 'FPS',
          data: fpsData,
          backgroundColor: 'rgba(13, 110, 253, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 0,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, title: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
    trackFPS();

    async function measureNetworkSpeed() {
      try {
        const startTime = performance.now();
        const response = await fetch('https://speed.hetzner.de/10MB.bin', { cache: 'no-cache' });
        if (!response.ok) {
          throw new Error(`Network response was not ok (${response.status})`);
        }
        const reader = response.body.getReader();
        let receivedLength = 0;
        while(true) {
          const {done, value} = await reader.read();
          if (done) break;
          receivedLength += value.length;
        }
        const endTime = performance.now();
        const durationInSeconds = (endTime - startTime) / 1000;
        const bitsLoaded = receivedLength * 8;
        const speedBps = bitsLoaded / durationInSeconds;
        const speedMbps = (speedBps / (1024 * 1024)).toFixed(2);
        return speedMbps;
      } catch {
        return null;
      }
    }

    let networkSpeedData = [];
    const networkSpeedCtx = document.getElementById('networkSpeedChart').getContext('2d');
    const networkSpeedChart = new Chart(networkSpeedCtx, {
      type: 'line',
      data: {
        labels: Array(10).fill(''),
        datasets: [{
          label: 'Speed (Mbps)',
          data: networkSpeedData,
          backgroundColor: 'rgba(13, 110, 253, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 3,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, suggestedMax: 100, title: { display: true, text: 'Mbps' }, grid: { color: '#333' } }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                return `Speed: ${context.parsed.y} Mbps`;
              }
            }
          }
        }
      }
    });

    async function updateNetworkSpeedChart() {
      const speedMbps = await measureNetworkSpeed();
      if (speedMbps !== null) {
        networkSpeedData.push(speedMbps);
        if (networkSpeedData.length > 10) {
          networkSpeedData.shift();
          networkSpeedChart.data.labels.shift();
        }
        networkSpeedChart.data.datasets[0].data = networkSpeedData;
        networkSpeedChart.update();
        const currentSpeedElement = document.getElementById('current-speed');
        currentSpeedElement.innerHTML = `Current Speed: <strong>${speedMbps} Mbps</strong>`;
        currentSpeedElement.style.color = '#198754'; /* Green */
      } else {
        const currentSpeedElement = document.getElementById('current-speed');
        currentSpeedElement.innerHTML = `Current Speed: <strong>-- Mbps</strong>`;
        currentSpeedElement.style.color = '#dc3545'; /* Red */
      }
    }
    updateNetworkSpeedChart();
    setInterval(updateNetworkSpeedChart, 60000);

    function updateBatteryStatus() {
      const batteryProgressBar = document.getElementById('battery-progress-bar');
      const batteryStatusText = document.getElementById('battery-status-text');
      if (navigator.getBattery) {
        navigator.getBattery().then(battery => {
          const batteryLevel = (battery.level * 100).toFixed(0);
          const chargingStatus = battery.charging ? "Charging" : "Not Charging";
          batteryProgressBar.style.width = `${batteryLevel}%`;
          batteryProgressBar.style.backgroundColor = battery.charging ? '#0dcaf0' : '#198754';
          batteryStatusText.innerHTML = `${batteryLevel}% - ${chargingStatus}`;
          batteryStatusText.style.color = battery.charging ? '#0dcaf0' : '#198754';
        });
      } else {
        batteryStatusText.innerHTML = "Battery status not supported by your browser.";
      }
    }

    function updateScreenResolution() {
      const screenRectangle = document.getElementById('screen-rectangle');
      const screenDimensionsText = document.getElementById('screen-dimensions-text');
      const width = window.screen.width;
      const height = window.screen.height;
      const maxDimension = Math.max(width, height);
      const scaledWidth = (width / maxDimension) * 100;
      const scaledHeight = (height / maxDimension) * 100;
      screenRectangle.style.width = `${scaledWidth}px`;
      screenRectangle.style.height = `${scaledHeight}px`;
      screenDimensionsText.innerHTML = `<strong>${width}px</strong> x <strong>${height}px</strong>`;
    }

    let mapInitialized = false;
    let mapInstance;
    function updateLocation() {
      const mapDiv = document.getElementById('map');
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const { latitude, longitude } = position.coords;
            if (mapDiv) {
              if (!mapInitialized) {
                mapInstance = L.map('map').setView([latitude, longitude], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                  attribution: '&copy; OpenStreetMap contributors'
                }).addTo(mapInstance);
                L.marker([latitude, longitude]).addTo(mapInstance)
                  .bindPopup('You are here.')
                  .openPopup();
                mapInitialized = true;
              } else {
                mapInstance.setView([latitude, longitude], 13);
                L.marker([latitude, longitude]).addTo(mapInstance)
                  .bindPopup('You are here.')
                  .openPopup();
              }
            }
          },
          () => {
            if (mapDiv) {
              mapDiv.innerHTML = "<p style='color: #dc3545;'>Location access denied.</p>";
            }
          }
        );
      } else {
        if (mapDiv) {
          mapDiv.innerHTML = "<p style='color: #dc3545;'>Geolocation not supported.</p>";
        }
      }
    }

    function updateTimeZone() {
      const timezoneInfo = document.getElementById('timezone-info');
      const localeInfo = document.getElementById('locale-info');
      const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const locale = navigator.language;
      timezoneInfo.innerText = timeZone;
      localeInfo.innerText = locale;
    }

    let memoryUsageData = [];
    function updateMemoryUsage() {
      const memoryUsage = performance.memory ? (performance.memory.usedJSHeapSize / 1048576).toFixed(2) : null;
      if (memoryUsage !== null) {
        memoryUsageData.push(memoryUsage);
        if (memoryUsageData.length > 30) {
          memoryUsageData.shift();
        }
        memoryChart.data.datasets[0].data = memoryUsageData;
        memoryChart.update();
      }
    }

    const memoryCtx = document.getElementById('memoryChart').getContext('2d');
    const memoryChart = new Chart(memoryCtx, {
      type: 'line',
      data: {
        labels: Array(30).fill(''),
        datasets: [{
          label: 'Memory Usage (MB)',
          data: memoryUsageData,
          backgroundColor: 'rgba(13, 110, 253, 0.2)',
          borderColor: 'var(--primary-color)',
          borderWidth: 2,
          fill: true,
          pointRadius: 0,
          tension: 0.4
        }]
      },
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: { beginAtZero: true, title: { display: false } }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
    setInterval(updateMemoryUsage, 1000);

    function updateSensorsAvailability() {
      const sensorsContent = document.getElementById('sensors-content');
      const sensors = [];
      if ('Accelerometer' in window) sensors.push('<li><i class="fas fa-check-circle" style="color: #198754;"></i> Accelerometer</li>');
      if ('Gyroscope' in window) sensors.push('<li><i class="fas fa-check-circle" style="color: #198754;"></i> Gyroscope</li>');
      if ('Magnetometer' in window) {
        sensors.push('<li><i class="fas fa-check-circle" style="color: #198754;"></i> Magnetometer</li>');
      } else {
        sensors.push('<li><i class="fas fa-times-circle" style="color: #dc3545;"></i> Magnetometer</li>');
      }
      if (sensors.length > 0) {
        sensorsContent.innerHTML = `<ul>${sensors.join('')}</ul>`;
      } else {
        sensorsContent.innerHTML = "<p>No motion sensors available.</p>";
      }
    }

    function updateMediaDevices() {
      const mediaDevicesList = document.getElementById('media-devices-list');
      if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
        navigator.mediaDevices.enumerateDevices().then(devices => {
          const deviceList = devices.map(device => {
            let icon = '';
            if (device.kind === 'audioinput') icon = '<i class="fas fa-microphone" style="color: var(--accent-color);"></i>';
            if (device.kind === 'audiooutput') icon = '<i class="fas fa-volume-up" style="color: var(--accent-color);"></i>';
            if (device.kind === 'videoinput') icon = '<i class="fas fa-video" style="color: var(--accent-color);"></i>';
            return `<li>${icon} ${device.label || 'Not Named'}</li>`;
          }).join('');
          mediaDevicesList.innerHTML = `<ul>${deviceList}</ul>`;
        }).catch(err => {
          console.error('Error accessing media devices:', err);
          mediaDevicesList.innerHTML = "<p style='color: #dc3545;'>Could not access media devices.</p>";
        });
      } else {
        mediaDevicesList.innerHTML = "<p style='color: #dc3545;'>Media Devices API not supported.</p>";
      }
    }

    function updateStorageUsage() {
      const storageContent = document.getElementById('storage-usage-content');
      if (navigator.storage && navigator.storage.estimate) {
        navigator.storage.estimate().then(estimate => {
          const used = estimate.usage || 0;
          const quota = estimate.quota || 1;
          const usedPercentage = ((used / quota) * 100).toFixed(2);
          const usedMB = (used / (1024 * 1024)).toFixed(2);
          const quotaMB = (quota / (1024 * 1024)).toFixed(2);
          const progressBar = document.getElementById('storage-progress-bar');
          const usageText = document.getElementById('storage-usage-text');
          progressBar.style.width = `${usedPercentage}%`;
          progressBar.style.backgroundColor = usedPercentage > 80 ? '#dc3545' : 'var(--primary-color)';
          usageText.innerHTML = `Used: ${usedMB} MB / Total: ${quotaMB} MB (${usedPercentage}%)`;
        });
      } else {
        storageContent.innerHTML = "<p style='color: #dc3545;'>Storage API not supported by your browser.</p>";
      }
    }

    function checkWebGLSupport() {
      const webglContent = document.getElementById('webgl-content');
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if (gl && gl instanceof WebGLRenderingContext) {
        webglContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #198754;"></i><br><p>WebGL is supported.</p>';
      } else {
        webglContent.innerHTML = '<i class="fas fa-times-circle" style="font-size: 48px; color: #dc3545;"></i><br><p>WebGL is not supported.</p>';
      }
    }

    function detectAdBlocker() {
      const adblockerContent = document.getElementById('adblocker-content');
      const ad = document.createElement('div');
      ad.innerHTML = '&nbsp;';
      ad.className = 'adsbox';
      ad.style.position = 'absolute';
      ad.style.top = '-9999px';
      document.body.appendChild(ad);
      window.setTimeout(() => {
        if (ad.offsetHeight === 0) {
          adblockerContent.innerHTML = '<i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ffc107;"></i><br><p>Ad blocker detected.</p>';
        } else {
          adblockerContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #198754;"></i><br><p>No ad blocker detected.</p>';
        }
        ad.remove();
      }, 100);
    }

    function checkServiceWorkerStatus() {
      const serviceworkerContent = document.getElementById('serviceworker-content');
      if ('serviceWorker' in navigator) {
        if (navigator.serviceWorker.controller) {
          serviceworkerContent.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; color: #198754;"></i><br><p>Service Worker is active.</p>';
        } else {
          serviceworkerContent.innerHTML = '<i class="fas fa-info-circle" style="font-size: 48px; color: #0dcaf0;"></i><br><p>Service Worker is supported but not registered.</p>';
        }
      } else {
        serviceworkerContent.innerHTML = '<i class="fas fa-times-circle" style="font-size: 48px; color: #dc3545;"></i><br><p>Service Workers are not supported.</p>';
      }
    }

    function getWebRTCIpAddresses() {
      const webrtcContent = document.getElementById('webrtc-content');
      const RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection;
      if (!RTCPeerConnection) {
        webrtcContent.innerHTML = "<p style='color: #dc3545;'>WebRTC not supported.</p>";
        return;
      }
      const pc = new RTCPeerConnection({ iceServers: [] });
      pc.createDataChannel("");
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .catch(err => {
          console.error('Error creating offer:', err);
        });
      const ips = new Set();
      pc.onicecandidate = event => {
        if (event.candidate) {
          const candidate = event.candidate.candidate;
          const regex = /([0-9]{1,3}\.){3}[0-9]{1,3}/;
          const match = candidate.match(regex);
          if (match) {
            ips.add(match[0]);
          }
        } else {
          if (ips.size > 0) {
            webrtcContent.innerHTML = `<strong>IP Addresses:</strong><br>${Array.from(ips).join('<br>')}`;
            webrtcContent.style.color = '#0dcaf0';
          } else {
            webrtcContent.innerHTML = "<p style='color: #dc3545;'>No IP addresses detected.</p>";
          }
          pc.close();
        }
      };
    }

    function performPingTest() {
      const pingCard = document.getElementById('ping-card');
      pingCard.scrollIntoView({ behavior: 'smooth' });
    }

    let pingChartInstance = null;
    function startPingTest(event) {
      event.preventDefault();
      const addressInput = document.getElementById('ping-address');
      const address = addressInput.value.trim();
      if (!address) {
        alert('Please enter a server address.');
        return;
      }
      if (pingChartInstance) {
        pingChartInstance.destroy();
        pingChartInstance = null;
      }
      const pingCtx = document.getElementById('pingChart').getContext('2d');
      pingChartInstance = new Chart(pingCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Ping (ms)',
            data: [],
            backgroundColor: 'rgba(13, 110, 253, 0.2)',
            borderColor: 'var(--primary-color)',
            borderWidth: 2,
            fill: true,
            pointRadius: 3,
            tension: 0.1
          }]
        },
        options: {
          animation: false,
          scales: {
            x: { display: true, title: { display: true, text: 'Ping Number' }, grid: { color: '#333' } },
            y: { beginAtZero: true, title: { display: true, text: 'Latency (ms)' }, suggestedMax: 1000, grid: { color: '#333' } }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Latency: ${context.parsed.y} ms`;
                }
              }
            }
          }
        }
      });
      let count = 0;
      function ping() {
        const startTime = Date.now();
        const img = new Image();
        img.onload = () => {
          const endTime = Date.now();
          const latency = endTime - startTime;
          pingChartInstance.data.labels.push(count + 1);
          pingChartInstance.data.datasets[0].data.push(latency);
          pingChartInstance.update();
          count++;
          if (count < 10) {
            setTimeout(ping, 1000);
          }
        };
        img.onerror = () => {
          pingChartInstance.data.labels.push(count + 1);
          pingChartInstance.data.datasets[0].data.push(null);
          pingChartInstance.update();
          count++;
          if (count < 10) {
            setTimeout(ping, 1000);
          }
        };
        img.src = `https://${address}/favicon.ico?cache=${Math.random()}`;
      }
      ping();
    }

    function performWebSearch(event) {
      event.preventDefault();
      const searchEngine = document.getElementById('search-engine').value;
      const query = document.getElementById('search-query').value.trim();
      if (!query) {
        alert('Please enter a search query.');
        return;
      }
      let searchURL = '';
      switch(searchEngine) {
        case 'google':
          searchURL = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
          break;
        case 'duckduckgo':
          searchURL = `https://duckduckgo.com/?q=${encodeURIComponent(query)}`;
          break;
        case 'yahoo':
          searchURL = `https://search.yahoo.com/search?p=${encodeURIComponent(query)}`;
          break;
        default:
          alert('Invalid search engine selected.');
          return;
      }
      window.open(searchURL, '_blank');
    }

    function startJsErrorAnalysis() {
      const analyzerUrlInput = document.getElementById('analyzer-url');
      const url = analyzerUrlInput.value.trim();
      const resultDiv = document.getElementById('js-error-analyzer-result');
      const iframe = document.getElementById('js-error-analyzer-iframe');
      if (!url) {
        alert('Please enter a website URL.');
        return;
      }
      try {
        new URL(url);
      } catch (e) {
        alert('Please enter a valid URL.');
        return;
      }
      resultDiv.innerHTML = 'Analyzing...';
      iframe.style.display = 'none';
      iframe.src = '';
      iframe.src = url;
      iframe.style.display = 'none';
      iframe.onload = function() {
        try {
          const iframeWindow = iframe.contentWindow;
          void iframeWindow.location.href;
          iframeWindow.onerror = function(message, source, lineno, colno, error) {
            iframeWindow.postMessage({
              type: 'js-error',
              error: { message: message, source: source, lineno: lineno, colno: colno }
            }, '*');
          };
          window.addEventListener('message', function messageHandler(event) {
            if (event.source !== iframeWindow) return;
            if (event.data.type === 'js-error') {
              displayJsError(event.data.error);
            }
          });
          resultDiv.innerHTML = '<p style="color: #198754;">No JavaScript errors detected.</p>';
        } catch (e) {
          resultDiv.innerHTML = '<p style="color: #dc3545;">Unable to analyze JavaScript errors due to cross-origin restrictions. Please ensure the URL is same-origin or use a local server.</p>';
          console.error('Cross-origin error:', e);
        }
      };
      function displayJsError(error) {
        if (resultDiv.innerHTML === 'Analyzing...') {
          resultDiv.innerHTML = `<strong style="color: #dc3545;">Errors Detected:</strong><br>`;
        }
        resultDiv.innerHTML += `<span style="color: #dc3545;">${error.message}</span> at <span style="color: var(--muted-text);">${error.source}:${error.lineno}:${error.colno}</span><br>`;
      }
    }

    let webcamStream = null;
    function toggleWebcam(event) {
      event.preventDefault();
      const videoElement = document.getElementById('webcam-video');
      const button = event.currentTarget;
      if (webcamStream) {
        webcamStream.getTracks().forEach(track => track.stop());
        webcamStream = null;
        videoElement.srcObject = null;
        videoElement.style.display = 'none';
        button.innerHTML = '<i class="fas fa-camera"></i> Test Webcam';
      } else {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            webcamStream = stream;
            videoElement.srcObject = stream;
            videoElement.style.display = 'block';
            button.innerHTML = '<i class="fas fa-camera-slash"></i> Stop Webcam';
          })
          .catch(err => {
            alert('Unable to access the webcam: ' + err.message);
            console.error('Webcam access error:', err);
          });
      }
    }

    let micStream = null;
    let audioContext = null;
    let analyserMic = null;
    let microphoneSource = null;
    let javascriptNodeMic = null;
    function toggleMicrophone(event) {
      event.preventDefault();
      const micLevel = document.getElementById('mic-level');
      const button = event.currentTarget;
      if (micStream) {
        micStream.getTracks().forEach(track => track.stop());
        micStream = null;
        if (audioContext) {
          audioContext.close();
          audioContext = null;
        }
        micLevel.style.width = '0%';
        button.innerHTML = '<i class="fas fa-microphone"></i> Test Microphone';
      } else {
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            micStream = stream;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyserMic = audioContext.createAnalyser();
            microphoneSource = audioContext.createMediaStreamSource(stream);
            javascriptNodeMic = audioContext.createScriptProcessor(2048, 1, 1);
            analyserMic.smoothingTimeConstant = 0.8;
            analyserMic.fftSize = 1024;
            microphoneSource.connect(analyserMic);
            analyserMic.connect(javascriptNodeMic);
            javascriptNodeMic.connect(audioContext.destination);
            javascriptNodeMic.onaudioprocess = function() {
              const array = new Uint8Array(analyserMic.frequencyBinCount);
              analyserMic.getByteFrequencyData(array);
              let values = 0;
              const length = array.length;
              for (let i = 0; i < length; i++) {
                values += array[i];
              }
              const average = values / length;
              const percentage = Math.min(100, Math.max(0, average));
              micLevel.style.width = `${percentage}%`;
            };
            button.innerHTML = '<i class="fas fa-microphone-slash"></i> Stop Microphone';
          })
          .catch(err => {
            alert('Unable to access the microphone: ' + err.message);
            console.error('Microphone access error:', err);
          });
      }
    }

    function updatePublicIP() {
      const publicIPElement = document.getElementById('public-ip');
      publicIPElement.innerHTML = 'Fetching...';
      publicIPElement.style.color = '#198754';
      fetch('https://api.ipify.org?format=json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`Network response was not ok (${response.status})`);
          }
          return response.json();
        })
        .then(data => {
          publicIPElement.innerHTML = data.ip;
          publicIPElement.style.color = '#198754';
        })
        .catch(err => {
          publicIPElement.innerHTML = 'Unable to fetch IP.';
          publicIPElement.style.color = '#dc3545';
          console.error('Public IP fetch error:', err);
        });
    }

    function performDNSLookup() {
      const domainInput = document.getElementById('dns-domain');
      const domain = domainInput.value.trim();
      const resultDiv = document.getElementById('dns-result');
      if (!domain) {
        alert('Please enter a domain name.');
        return;
      }
      resultDiv.innerHTML = 'Looking up...';
      resultDiv.style.color = '#0dcaf0';
      fetch(`https://dns.google/resolve?name=${encodeURIComponent(domain)}&type=A`, {
        method: 'GET',
        headers: { 'Accept': 'application/dns-json' }
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Network response was not ok (${response.status})`);
        }
        return response.json();
      })
      .then(data => {
        if (data.Status === 0 && data.Answer) {
          const ips = data.Answer.filter(record => record.type === 1).map(record => record.data);
          if (ips.length > 0) {
            resultDiv.innerHTML = `<strong>A Records:</strong><br>${ips.join('<br>')}`;
            resultDiv.style.color = '#198754';
          } else {
            resultDiv.innerHTML = 'No A records found.';
            resultDiv.style.color = '#dc3545';
          }
        } else {
          resultDiv.innerHTML = 'DNS lookup failed or no records found.';
          resultDiv.style.color = '#dc3545';
        }
      })
      .catch(err => {
        resultDiv.innerHTML = 'Error performing DNS lookup.';
        resultDiv.style.color = '#dc3545';
        console.error('DNS lookup error:', err);
      });
    }

    function runAccessibilityCheckOnDocument(doc) {
      let missingAlts = 0;
      let missingLabels = 0;

      const images = doc.querySelectorAll('img');
      images.forEach(img => {
        if (!img.hasAttribute('alt') || img.getAttribute('alt').trim() === '') {
          missingAlts++;
        }
      });

      const inputs = doc.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        const id = input.id;
        const hasLabel = id && doc.querySelector(`label[for="${id}"]`);
        const ariaLabel = input.getAttribute('aria-label');
        if (!hasLabel && !ariaLabel) {
          missingLabels++;
        }
      });

      let report = `<strong>Accessibility Report:</strong><br>`;
      report += `Images missing alt attributes: <span style="color: ${missingAlts > 0 ? '#dc3545' : '#198754'};">${missingAlts}</span><br>`;
      report += `Form fields missing labels or aria-label: <span style="color: ${missingLabels > 0 ? '#dc3545' : '#198754'};">${missingLabels}</span><br>`;
      return report;
    }

    function checkWebsiteAccessibility() {
      const resultsDiv = document.getElementById('accessibility-results');
      const iframe = document.getElementById('accessibility-iframe');
      const urlInput = document.getElementById('accessibility-url');
      const url = urlInput.value.trim();

      if (!url) {
        alert('Please enter a website URL.');
        return;
      }

      try {
        new URL(url);
      } catch {
        alert('Please enter a valid URL.');
        return;
      }

      resultsDiv.innerHTML = 'Checking...';
      resultsDiv.style.color = '#0dcaf0';
      iframe.src = '';
      iframe.style.display = 'none';

      iframe.onload = function() {
        try {
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          if (!iframeDoc) {
            throw new Error('No iframe document');
          }
          const report = runAccessibilityCheckOnDocument(iframeDoc);
          resultsDiv.innerHTML = report;
          if (report.includes('#dc3545')) {
            resultsDiv.style.color = '#dc3545';
          } else {
            resultsDiv.style.color = '#198754';
          }
        } catch (e) {
          console.error('Cross-origin or access error:', e);
          resultsDiv.innerHTML = '<p style="color: #dc3545;">Unable to analyze accessibility due to cross-origin restrictions or inaccessible content.</p>';
        }
      };

      iframe.src = url;
      setTimeout(() => {
        if (resultsDiv.innerHTML === 'Checking...') {
          resultsDiv.innerHTML = '<p style="color: #dc3545;">Unable to analyze accessibility due to cross-origin restrictions or time-out accessing content.</p>';
        }
      }, 5000);
    }

    function runCompatibilityCheck() {
      const resultsDiv = document.getElementById('compatibility-results');
      resultsDiv.innerHTML = 'Checking...';
      resultsDiv.style.color = '#0dcaf0';

      const features = {
        'Service Workers': 'serviceWorker' in navigator,
        'WebAssembly': typeof WebAssembly === 'object',
        'Web Components (customElements)': 'customElements' in window,
        'Intersection Observer': 'IntersectionObserver' in window,
        'Fetch API': 'fetch' in window
      };

      let report = `<strong>Browser Compatibility Report:</strong><br>`;
      for (const [feature, supported] of Object.entries(features)) {
        report += `${feature}: ${supported ? '<span style="color: #198754;">Supported</span>' : '<span style="color: #dc3545;">Not Supported</span>'}<br>`;
      }
      resultsDiv.innerHTML = report;
    }

    function generatePassword(length, includeUpper, includeNumbers, includeSpecial) {
      const lowercase = 'abcdefghijklmnopqrstuvwxyz';
      const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      const special = '!@#$%^&*()_+~`|}{[]:;?><,./-=';
      
      let characters = lowercase;
      if (includeUpper) characters += uppercase;
      if (includeNumbers) characters += numbers;
      if (includeSpecial) characters += special;
      
      let password = '';
      for (let i = 0; i < length; i++) {
        password += characters.charAt(Math.floor(Math.random() * characters.length));
      }
      return password;
    }
    
    document.getElementById('generate-password-btn').addEventListener('click', () => {
      const length = parseInt(document.getElementById('password-length').value);
      const includeUpper = document.getElementById('include-uppercase').checked;
      const includeNumbers = document.getElementById('include-numbers').checked;
      const includeSpecial = document.getElementById('include-special').checked;
      
      if (length < 4) {
        alert('Password length should be at least 4 characters.');
        return;
      }
      
      const password = generatePassword(length, includeUpper, includeNumbers, includeSpecial);
      document.getElementById('generated-password').innerText = password;
    });

    const units = {
      length: ['Meters', 'Kilometers', 'Miles', 'Yards', 'Feet', 'Inches'],
      weight: ['Kilograms', 'Grams', 'Pounds', 'Ounces'],
      temperature: ['Celsius', 'Fahrenheit', 'Kelvin'],
      volume: ['Liters', 'Milliliters', 'Gallons', 'Cups']
    };

    const conversionRates = {
      length: {
        Meters: 1,
        Kilometers: 0.001,
        Miles: 0.000621371,
        Yards: 1.09361,
        Feet: 3.28084,
        Inches: 39.3701
      },
      weight: {
        Kilograms: 1,
        Grams: 1000,
        Pounds: 2.20462,
        Ounces: 35.274
      },
      temperature: {
        Celsius: 'Celsius',
        Fahrenheit: 'Fahrenheit',
        Kelvin: 'Kelvin'
      },
      volume: {
        Liters: 1,
        Milliliters: 1000,
        Gallons: 0.264172,
        Cups: 4.22675
      }
    };

    function populateUnits() {
      const category = document.getElementById('conversion-category').value;
      const fromUnit = document.getElementById('from-unit');
      const toUnit = document.getElementById('to-unit');
      
      fromUnit.innerHTML = '';
      toUnit.innerHTML = '';
      
      units[category].forEach(unit => {
        const option1 = document.createElement('option');
        option1.value = unit;
        option1.text = unit;
        fromUnit.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = unit;
        option2.text = unit;
        toUnit.appendChild(option2);
      });
    }

    document.getElementById('conversion-category').addEventListener('change', populateUnits);
    window.addEventListener('load', populateUnits);

    function convertUnits() {
      const category = document.getElementById('conversion-category').value;
      const fromUnit = document.getElementById('from-unit').value;
      const toUnit = document.getElementById('to-unit').value;
      const value = parseFloat(document.getElementById('input-value').value);
      
      if (isNaN(value)) {
        alert('Please enter a valid number.');
        return;
      }
      
      let result;
      
      if (category === 'temperature') {
        if (fromUnit === 'Celsius') {
          if (toUnit === 'Fahrenheit') {
            result = (value * 9/5) + 32;
          } else if (toUnit === 'Kelvin') {
            result = value + 273.15;
          } else {
            result = value;
          }
        } else if (fromUnit === 'Fahrenheit') {
          if (toUnit === 'Celsius') {
            result = (value - 32) * 5/9;
          } else if (toUnit === 'Kelvin') {
            result = ((value - 32) * 5/9) + 273.15;
          } else {
            result = value;
          }
        } else if (fromUnit === 'Kelvin') {
          if (toUnit === 'Celsius') {
            result = value - 273.15;
          } else if (toUnit === 'Fahrenheit') {
            result = ((value - 273.15) * 9/5) + 32;
          } else {
            result = value;
          }
        }
      } else {
        const fromRate = conversionRates[category][fromUnit];
        const toRate = conversionRates[category][toUnit];
        result = (value * toRate) / fromRate;
      }
      
      document.getElementById('conversion-result').innerText = `${value} ${fromUnit} = ${result.toFixed(4)} ${toUnit}`;
    }

    document.getElementById('convert-btn').addEventListener('click', convertUnits);

    function analyzeText(text) {
      const words = text.trim().split(/\s+/).filter(word => word.length > 0);
      const wordCount = words.length;
      const charCount = text.length;
      const sentences = text.split(/[.!?]+/).filter(sentence => sentence.trim().length > 0);
      const sentenceCount = sentences.length;
      const readingTime = (wordCount / 200).toFixed(2);
      
      const frequency = {};
      words.forEach(word => {
        const normalized = word.toLowerCase().replace(/[^a-z0-9]/g, '');
        if (normalized) {
          frequency[normalized] = (frequency[normalized] || 0) + 1;
        }
      });
      
      const sortedWords = Object.entries(frequency).sort((a, b) => b[1] - a[1]);
      const topKeywords = sortedWords.slice(0, 5).map(entry => `${entry[0]} (${entry[1]})`).join(', ');
      
      return `
        <strong>Word Count:</strong> ${wordCount}<br>
        <strong>Character Count:</strong> ${charCount}<br>
        <strong>Sentence Count:</strong> ${sentenceCount}<br>
        <strong>Estimated Reading Time:</strong> ${readingTime} minutes<br>
        <strong>Top Keywords:</strong> ${topKeywords || 'N/A'}
      `;
    }

    document.getElementById('analyze-text-btn').addEventListener('click', () => {
      const text = document.getElementById('text-input').value;
      if (!text.trim()) {
        alert('Please enter some text to analyze.');
        return;
      }
      const analysis = analyzeText(text);
      document.getElementById('text-analysis-result').innerHTML = analysis;
    });

    function encodeURL(url) {
      try {
        return encodeURIComponent(url);
      } catch {
        return 'Invalid URL';
      }
    }

    function decodeURL(url) {
      try {
        return decodeURIComponent(url);
      } catch {
        return 'Invalid URL';
      }
    }

    document.getElementById('encode-url-btn').addEventListener('click', () => {
      const url = document.getElementById('url-input').value;
      if (!url.trim()) {
        alert('Please enter a URL to encode.');
        return;
      }
      const encoded = encodeURL(url);
      document.getElementById('url-result').innerText = encoded;
    });

    document.getElementById('decode-url-btn').addEventListener('click', () => {
      const url = document.getElementById('url-input').value;
      if (!url.trim()) {
        alert('Please enter a URL to decode.');
        return;
      }
      const decoded = decodeURL(url);
      document.getElementById('url-result').innerText = decoded;
    });

    function getLuminance(hex) {
      const rgb = hex.match(/\w\w/g).map(x => parseInt(x, 16) / 255);
      const a = rgb.map(v => {
        return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
    }

    function calculateContrast(hex1, hex2) {
      const lum1 = getLuminance(hex1);
      const lum2 = getLuminance(hex2);
      const brightest = Math.max(lum1, lum2);
      const darkest = Math.min(lum1, lum2);
      const contrast = (brightest + 0.05) / (darkest + 0.05);
      return contrast.toFixed(2);
    }

    document.getElementById('check-contrast-btn').addEventListener('click', () => {
      const color1 = document.getElementById('color1').value;
      const color2 = document.getElementById('color2').value;
      const contrastRatio = calculateContrast(color1, color2);
      
      let compliance = '';
      if (contrastRatio >= 7) {
        compliance = 'AAA';
      } else if (contrastRatio >= 4.5) {
        compliance = 'AA';
      } else {
        compliance = 'Fail';
      }
      
      let colorScheme = 'Good contrast';
      let color = '#198754'; 
      if (compliance === 'AA') {
        colorScheme = 'Acceptable contrast';
        color = '#ffc107';
      } else if (compliance === 'Fail') {
        colorScheme = 'Poor contrast';
        color = '#dc3545';
      }
      
      document.getElementById('contrast-result').innerHTML = `
        <strong>Contrast Ratio:</strong> ${contrastRatio}:1<br>
        <strong>WCAG Compliance:</strong> ${compliance} (${colorScheme})
      `;
      document.getElementById('contrast-result').style.color = color;
    });

    let currentInput = '';
    let operator = '';
    let previousInput = '';

    const display = document.getElementById('calculator-display');

    document.querySelectorAll('.calc-btn').forEach(button => {
      button.addEventListener('click', () => {
        const value = button.getAttribute('data-value');
        
        if (!value) return;
        
        if (!isNaN(value) || value === '.') {
          currentInput += value;
          display.value = currentInput;
        } else if (['+', '-', '*', '/'].includes(value)) {
          if (currentInput === '') return;
          operator = value;
          previousInput = currentInput;
          currentInput = '';
        }
      });
    });

    document.getElementById('clear-btn').addEventListener('click', () => {
      currentInput = '';
      operator = '';
      previousInput = '';
      display.value = '';
    });

    document.getElementById('equals-btn').addEventListener('click', () => {
      if (operator === '' || currentInput === '' || previousInput === '') return;
      
      const num1 = parseFloat(previousInput);
      const num2 = parseFloat(currentInput);
      let result;
      
      switch(operator) {
        case '+':
          result = num1 + num2;
          break;
        case '-':
          result = num1 - num2;
          break;
        case '*':
          result = num1 * num2;
          break;
        case '/':
          if (num2 === 0) {
            alert('Cannot divide by zero.');
            return;
          }
          result = num1 / num2;
          break;
        default:
          return;
      }
      
      display.value = result;
      currentInput = result.toString();
      operator = '';
      previousInput = '';
    });

    document.getElementById('generate-qr-btn').addEventListener('click', () => {
      const qrText = document.getElementById('qr-text-input').value.trim();
      const qrCodeDiv = document.getElementById('qr-code');
      
      if (!qrText) {
        alert('Please enter text or a URL to generate QR Code.');
        return;
      }
      
      qrCodeDiv.innerHTML = '';
      new QRCode(qrCodeDiv, {
        text: qrText,
        width: 128,
        height: 128,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
      });
    });

    document.getElementById('add-todo-btn').addEventListener('click', () => {
      const taskInput = document.getElementById('todo-input');
      const taskText = taskInput.value.trim();
      
      if (!taskText) {
        alert('Please enter a task.');
        return;
      }
      
      const todoList = document.getElementById('todo-list');
      
      const li = document.createElement('li');
      li.style.display = 'flex';
      li.style.alignItems = 'center';
      li.style.justifyContent = 'space-between';
      li.style.padding = '8px 0';
      li.style.borderBottom = '1px solid #444';
      
      const taskSpan = document.createElement('span');
      taskSpan.innerText = taskText;
      taskSpan.style.flexGrow = '1';
      taskSpan.style.marginLeft = '10px';
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.style.marginRight = '10px';
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          taskSpan.style.textDecoration = 'line-through';
          taskSpan.style.color = '#6c757d';
        } else {
          taskSpan.style.textDecoration = 'none';
          taskSpan.style.color = '#ffffff';
        }
      });
      
      const deleteBtn = document.createElement('button');
      deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
      deleteBtn.style.background = 'none';
      deleteBtn.style.border = 'none';
      deleteBtn.style.color = '#dc3545';
      deleteBtn.style.cursor = 'pointer';
      deleteBtn.addEventListener('click', () => {
        todoList.removeChild(li);
      });
      
      li.appendChild(checkbox);
      li.appendChild(taskSpan);
      li.appendChild(deleteBtn);
      
      todoList.appendChild(li);
      
      taskInput.value = '';
    });

    function populateLocalStorageTable() {
      const tableBody = document.getElementById('local-storage-table-body');
      tableBody.innerHTML = '';
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        
        const tr = document.createElement('tr');
        
        const tdKey = document.createElement('td');
        tdKey.innerText = key;
        
        const tdValue = document.createElement('td');
        tdValue.innerText = value;
        
        const tdAction = document.createElement('td');
        const deleteBtn = document.createElement('button');
        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
        deleteBtn.style.background = 'none';
        deleteBtn.style.border = 'none';
        deleteBtn.style.color = '#dc3545';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Are you sure you want to delete the key "${key}"?`)) {
            localStorage.removeItem(key);
            populateLocalStorageTable();
          }
        });
        tdAction.appendChild(deleteBtn);
        
        tr.appendChild(tdKey);
        tr.appendChild(tdValue);
        tr.appendChild(tdAction);
        
        tableBody.appendChild(tr);
      }
    }

    document.getElementById('refresh-storage-btn').addEventListener('click', populateLocalStorageTable);

    window.addEventListener('load', populateLocalStorageTable);

    function captureWebsiteSnapshot() {
      const snapshotUrlInput = document.getElementById('snapshot-url');
      const snapshotButton = document.getElementById('snapshot-button');
      const snapshotImage = document.getElementById('website-snapshot-image');
      const snapshotMessage = document.getElementById('snapshot-message');
      const url = snapshotUrlInput.value.trim();

      if (!url) {
        alert('Please enter a website URL.');
        return;
      }

      try {
        new URL(url);
      } catch {
        alert('Please enter a valid URL.');
        return;
      }

      const apiKey = '8848c51f2c1271e071020ffb35490245';
      const apiURL = `http://api.screenshotlayer.com/api/capture?access_key=${encodeURIComponent(apiKey)}&url=${encodeURIComponent(url)}&viewport=1440x900&width=250`;

      snapshotMessage.innerHTML = 'Capturing snapshot...';
      snapshotMessage.style.color = '#0dcaf0';
      snapshotImage.style.display = 'none';
      snapshotImage.src = '';

      fetch(apiURL)
        .then(response => {
          if (!response.ok) {
            throw new Error(`Network response was not ok (${response.status})`);
          }
          return response.json();
        })
        .then(data => {
          if (data.screenshot) {
            snapshotImage.src = data.screenshot;
            snapshotImage.style.display = 'block';
            snapshotMessage.innerHTML = 'Snapshot captured successfully.';
            snapshotMessage.style.color = '#198754';
          } else {
            throw new Error('Snapshot not available.');
          }
        })
        .catch(err => {
          snapshotMessage.innerHTML = 'Error capturing snapshot. Please ensure the URL is correct and the API key is valid.';
          snapshotMessage.style.color = '#dc3545';
          console.error('Snapshot capture error:', err);
        });
    }

    function initializeDashboard() {
      updateSystemInfo();
      updateInternetConnectivity();
      updateBatteryStatus();
      updateScreenResolution();
      updateLocation();
      updateTimeZone();
      updateMemoryUsage();
      updateSensorsAvailability();
      updateMediaDevices();
      checkWebGLSupport();
      detectAdBlocker();
      checkServiceWorkerStatus();
      getWebRTCIpAddresses();
      updateJsErrors();
      updatePublicIP();
      updateVisitorCount();
      updateStorageUsage();

      setInterval(updateInternetConnectivity, 5000);
      setInterval(updateBatteryStatus, 60000);
      setInterval(updateSystemInfo, 60000);
    }

    window.addEventListener('resize', updateScreenResolution);
    window.addEventListener('load', () => {
      initializeDashboard();

      document.getElementById('copy-system-info-btn').addEventListener('click', copySystemInfo);
      document.getElementById('clear-local-storage-btn').addEventListener('click', clearLocalStorage);
      document.getElementById('clear-session-storage-btn').addEventListener('click', clearSessionStorage);
      document.getElementById('clear-cookies-btn').addEventListener('click', clearCookies);
      document.getElementById('reset-app-data-btn').addEventListener('click', resetAppData);
      document.getElementById('reload-page-btn').addEventListener('click', reloadPage);
      document.getElementById('retest-connectivity-btn').addEventListener('click', updateInternetConnectivity);
      document.getElementById('retest-location-btn').addEventListener('click', updateLocation);
      document.getElementById('retest-media-devices-btn').addEventListener('click', updateMediaDevices);
      document.getElementById('retest-webrtc-btn').addEventListener('click', getWebRTCIpAddresses);
      document.getElementById('clear-errors-btn').addEventListener('click', clearErrors);
      document.getElementById('perform-ping-test-btn').addEventListener('click', performPingTest);
      document.getElementById('search-button').addEventListener('click', performWebSearch);
      document.getElementById('start-ping-test-btn').addEventListener('click', startPingTest);
      document.getElementById('refresh-ip-btn').addEventListener('click', updatePublicIP);
      document.getElementById('dns-lookup-btn').addEventListener('click', performDNSLookup);
      document.getElementById('start-js-error-analysis-btn').addEventListener('click', startJsErrorAnalysis);
      document.getElementById('toggle-webcam-btn').addEventListener('click', toggleWebcam);
      document.getElementById('toggle-microphone-btn').addEventListener('click', toggleMicrophone);
      document.getElementById('check-website-accessibility').addEventListener('click', checkWebsiteAccessibility);
      document.getElementById('run-compatibility-check').addEventListener('click', runCompatibilityCheck);
      document.getElementById('snapshot-button').addEventListener('click', captureWebsiteSnapshot);

      const sidebar = document.getElementById('sidebar');
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const overlay = document.getElementById('overlay');
      const mainContent = document.getElementById('main-content');

      hamburgerBtn.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
        mainContent.classList.toggle('shifted');
      });

      overlay.addEventListener('click', () => {
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
        mainContent.classList.remove('shifted');
      });
    });
  </script>
</body>
</html>
